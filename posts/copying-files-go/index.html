<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>åœ¨ Go ä¸­å¤åˆ¶æ–‡ä»¶çš„ä¸‰ç§æ–¹æ³•ï½œå…­å¼€ç®±</title><meta name=keywords content="Go,å¤åˆ¶æ–‡ä»¶,io.Copy,os.Write"><meta name=description content="æœ¬æ–‡æ˜¯ Go ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ï¼Œæˆ‘å°†ä»‹ç»ä¸‰ç§æœ€æµè¡Œçš„å¤åˆ¶æ–‡ä»¶çš„æ–¹æ³•ã€‚"><meta name=author content="å…­å¼€ç®±"><link rel=canonical href=https://lkxed.github.io/posts/copying-files-go/><link crossorigin=anonymous href=/assets/css/stylesheet.min.09b98575a0a9c52a0dcff6660328188f9365049be8c47253f3072a85d10d82a5.css integrity="sha256-CbmFdaCpxSoNz/ZmAygYj5NlBJvoxHJT8wcqhdENgqU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.e85ad0406048e8176e1c7661b25d5c69297ddfe41dc4124cf75ecb99a4f7b3d1.js integrity="sha256-6FrQQGBI6BduHHZhsl1caSl93+QdxBJM917LmaT3s9E=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://lkxed.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lkxed.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lkxed.github.io/favicon-32x32.png><link rel=manifest href=https://lkxed.github.io/site.webmanifest><link rel=apple-touch-icon href=https://lkxed.github.io/apple-touch-icon.png><link rel=mask-icon href=https://lkxed.github.io/safari-pinned-tab.svg><meta name=theme-color content="#f5f5f5" media="(prefers-color-scheme: light)"><meta name=theme-color content="#1d1e20" media="(prefers-color-scheme: dark)"><meta name=msapplication-TileColor content="#ffffff"><noscript><style>.top-link{display:none}</style></noscript><meta name=shenma-site-verification content="0834e815906a93375245a759f409f8b0_1648880760"><meta name=baidu-site-verification content="code-2I1Hg4GETM"><meta name=google-site-verification content="xBkkt93v_nso_R-2aQ-An4rbc_Gi_4rNFi8oBEKDNjc"><meta property="og:title" content="åœ¨ Go ä¸­å¤åˆ¶æ–‡ä»¶çš„ä¸‰ç§æ–¹æ³•"><meta property="og:description" content="æœ¬æ–‡æ˜¯ Go ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ï¼Œæˆ‘å°†ä»‹ç»ä¸‰ç§æœ€æµè¡Œçš„å¤åˆ¶æ–‡ä»¶çš„æ–¹æ³•ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://lkxed.github.io/posts/copying-files-go/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-31T15:34:27+08:00"><meta property="article:modified_time" content="2022-05-31T15:34:27+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="åœ¨ Go ä¸­å¤åˆ¶æ–‡ä»¶çš„ä¸‰ç§æ–¹æ³•"><meta name=twitter:description content="æœ¬æ–‡æ˜¯ Go ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ï¼Œæˆ‘å°†ä»‹ç»ä¸‰ç§æœ€æµè¡Œçš„å¤åˆ¶æ–‡ä»¶çš„æ–¹æ³•ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ–‡ç« ","item":"https://lkxed.github.io/posts/"},{"@type":"ListItem","position":2,"name":"åœ¨ Go ä¸­å¤åˆ¶æ–‡ä»¶çš„ä¸‰ç§æ–¹æ³•","item":"https://lkxed.github.io/posts/copying-files-go/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"åœ¨ Go ä¸­å¤åˆ¶æ–‡ä»¶çš„ä¸‰ç§æ–¹æ³•","name":"åœ¨ Go ä¸­å¤åˆ¶æ–‡ä»¶çš„ä¸‰ç§æ–¹æ³•","description":"æœ¬æ–‡æ˜¯ Go ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ï¼Œæˆ‘å°†ä»‹ç»ä¸‰ç§æœ€æµè¡Œçš„å¤åˆ¶æ–‡ä»¶çš„æ–¹æ³•ã€‚","keywords":["Go","å¤åˆ¶æ–‡ä»¶","io.Copy","os.Write"],"articleBody":" æœ¬æ–‡æ˜¯ Go ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ï¼Œæˆ‘å°†ä»‹ç»ä¸‰ç§æœ€æµè¡Œçš„å¤åˆ¶æ–‡ä»¶çš„æ–¹æ³•ã€‚\nå‰è¨€ æœ¬æ–‡å°†ä»‹ç»å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Go ç¼–ç¨‹è¯­è¨€ æ¥å¤åˆ¶æ–‡ä»¶ã€‚åœ¨ Go ä¸­å¤åˆ¶æ–‡ä»¶çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæˆ‘åªä»‹ç»ä¸‰ç§æœ€å¸¸è§çš„ï¼šä½¿ç”¨ Go åº“ä¸­çš„ io.Copy() å‡½æ•°è°ƒç”¨ã€ä¸€æ¬¡è¯»å–è¾“å…¥æ–‡ä»¶å¹¶å°†å…¶å†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œä»¥åŠä½¿ç”¨ç¼“å†²åŒºä¸€å—å—åœ°å¤åˆ¶æ–‡ä»¶ã€‚\næ–¹æ³•ä¸€ï¼šä½¿ç”¨ io.Copy() ç¬¬ä¸€ç§æ–¹æ³•å°±æ˜¯ä½¿ç”¨ Go æ ‡å‡†åº“çš„ io.Copy() å‡½æ•°ã€‚ä½ å¯ä»¥åœ¨ copy() å‡½æ•°çš„ä»£ç ä¸­æ‰¾åˆ°å®ƒçš„å®ç°é€»è¾‘ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nfunc copy(src, dst string) (int64, error) { sourceFileStat, err := os.Stat(src) if err != nil { return 0, err } if !sourceFileStat.Mode().IsRegular() { return 0, fmt.Errorf(\"%s is not a regular file\", src) } source, err := os.Open(src) if err != nil { return 0, err } defer source.Close() destination, err := os.Create(dst) if err != nil { return 0, err } defer destination.Close() nBytes, err := io.Copy(destination, source) return nBytes, err } é¦–å…ˆï¼Œä¸Šè¿°ä»£ç åšäº†ä¸¤ä¸ªåˆ¤æ–­ï¼Œä»¥ä¾¿ç¡®å®šå®ƒå¯ä»¥è¢«æ‰“å¼€è¯»å–ï¼šä¸€æ˜¯åˆ¤æ–­å°†è¦å¤åˆ¶çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆos.Stat(src)ï¼‰ï¼ŒäºŒæ˜¯åˆ¤æ–­å®ƒæ˜¯å¦ä¸ºå¸¸è§„æ–‡ä»¶ï¼ˆsourceFileStat.Mode().IsRegular()ï¼‰ã€‚å‰©ä¸‹çš„æ‰€æœ‰å·¥ä½œéƒ½ç”± io.Copy(destination, source) è¿™è¡Œä»£ç æ¥å®Œæˆã€‚io.Copy() å‡½æ•°æ‰§è¡Œç»“æŸåï¼Œä¼šè¿”å›å¤åˆ¶çš„å­—èŠ‚æ•°å’Œå¤åˆ¶è¿‡ç¨‹ä¸­å‘ç”Ÿçš„ç¬¬ä¸€æ¡é”™è¯¯æ¶ˆæ¯ã€‚åœ¨ Go ä¸­ï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯æ¶ˆæ¯ï¼Œé”™è¯¯å˜é‡çš„å€¼å°±ä¸º nilã€‚\nä½ å¯ä»¥åœ¨ io åŒ… çš„æ–‡æ¡£é¡µé¢äº†è§£æœ‰å…³ io.Copy() å‡½æ•°çš„æ›´å¤šä¿¡æ¯ã€‚\nè¿è¡Œ cp1.go å°†äº§ç”Ÿä»¥ä¸‹è¾“å‡ºï¼š\n$ go run cp1.go Please provide two command line arguments! $ go run cp1.go fileCP.txt /tmp/fileCPCOPY Copied 3826 bytes! $ diff fileCP.txt /tmp/fileCPCOPY è¿™ä¸ªæ–¹æ³•å·²ç»éå¸¸ç®€å•äº†ï¼Œä¸è¿‡å®ƒæ²¡æœ‰ä¸ºå¼€å‘è€…æä¾›çµæ´»æ€§ã€‚è¿™å¹¶ä¸æ€»æ˜¯ä¸€ä»¶åäº‹ï¼Œä½†æ˜¯ï¼Œæœ‰äº›æ—¶å€™ï¼Œå¼€å‘è€…å¯èƒ½ä¼šéœ€è¦/æƒ³è¦å‘Šè¯‰ç¨‹åºè¯¥å¦‚ä½•è¯»å–æ–‡ä»¶ã€‚\næ–¹æ³•äºŒï¼šä½¿ç”¨ ioutil.WriteFile() å’Œ ioutil.ReadFile() å¤åˆ¶æ–‡ä»¶çš„ç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨ ioutil.ReadFile() å’Œ ioutil.WriteFile() å‡½æ•°ã€‚ç¬¬ä¸€ä¸ªå‡½æ•°ç”¨äºå°†æ•´ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œä¸€æ¬¡æ€§åœ°è¯»å…¥åˆ°æŸä¸ªå†…å­˜ä¸­çš„å­—èŠ‚åˆ‡ç‰‡é‡Œï¼›ç¬¬äºŒä¸ªå‡½æ•°åˆ™ç”¨äºå°†å­—èŠ‚åˆ‡ç‰‡çš„å†…å®¹å†™å…¥åˆ°ä¸€ä¸ªç£ç›˜æ–‡ä»¶ä¸­ã€‚\nå®ç°ä»£ç å¦‚ä¸‹ï¼š\ninput, err := ioutil.ReadFile(sourceFile) if err != nil { fmt.Println(err) return } err = ioutil.WriteFile(destinationFile, input, 0644) if err != nil { fmt.Println(\"Error creating\", destinationFile) fmt.Println(err) return } ä¸Šè¿°ä»£ç åŒ…æ‹¬äº†ä¸¤ä¸ª if ä»£ç å—ï¼ˆå—¯ï¼Œç”¨ Go å†™ç¨‹åºå°±æ˜¯è¿™æ ·çš„ï¼‰ï¼Œç¨‹åºçš„å®é™…åŠŸèƒ½å…¶å®ä½“ç°åœ¨ ioutil.ReadFile() å’Œ ioutil.WriteFile() è¿™ä¸¤è¡Œä»£ç ä¸­ã€‚\nè¿è¡Œ cp2.goï¼Œä½ ä¼šå¾—åˆ°ä¸‹é¢çš„è¾“å‡ºï¼š\n$ go run cp2.go Please provide two command line arguments! $ go run cp2.go fileCP.txt /tmp/copyFileCP $ diff fileCP.txt /tmp/copyFileCP è¯·æ³¨æ„ï¼Œè™½ç„¶è¿™ç§æ–¹æ³•èƒ½å¤Ÿå®ç°æ–‡ä»¶å¤åˆ¶ï¼Œä½†å®ƒåœ¨å¤åˆ¶å¤§æ–‡ä»¶æ—¶çš„æ•ˆç‡å¯èƒ½ä¸é«˜ã€‚è¿™æ˜¯å› ä¸ºå½“æ–‡ä»¶å¾ˆå¤§æ—¶ï¼Œioutil.ReadFile() è¿”å›çš„å­—èŠ‚åˆ‡ç‰‡ä¼šå¾ˆå¤§ã€‚\næ–¹æ³•ä¸‰ï¼šä½¿ç”¨ os.Read() å’Œ os.Write() åœ¨ Go ä¸­å¤åˆ¶æ–‡ä»¶çš„ç¬¬ä¸‰ç§æ–¹æ³•å°±æ˜¯ä¸‹é¢è¦ä»‹ç»çš„ cp3.goã€‚å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼šè¾“å…¥æ–‡ä»¶åã€è¾“å‡ºæ–‡ä»¶åå’Œç¼“å†²åŒºå¤§å°ã€‚\ncp3.go æœ€é‡è¦çš„éƒ¨åˆ†ä½äºä»¥ä¸‹ for å¾ªç¯ä¸­ï¼Œä½ å¯ä»¥åœ¨ copy() å‡½æ•°ä¸­æ‰¾åˆ°å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nbuf := make([]byte, BUFFERSIZE) for { n, err := source.Read(buf) if err != nil \u0026\u0026 err != io.EOF { return err } if n == 0 { break } if _, err := destination.Write(buf[:n]); err != nil { return err } } è¯¥æ–¹æ³•ä½¿ç”¨ os.Read() å°†è¾“å…¥æ–‡ä»¶çš„ä¸€å°éƒ¨åˆ†è¯»å…¥åä¸º buf çš„ç¼“å†²åŒºï¼Œç„¶åä½¿ç”¨ os.Write() å°†è¯¥ç¼“å†²åŒºçš„å†…å®¹å†™å…¥æ–‡ä»¶ã€‚å½“è¯»å–å‡ºé”™æˆ–åˆ°è¾¾æ–‡ä»¶æœ«å°¾ï¼ˆio.EOFï¼‰æ—¶ï¼Œå¤åˆ¶è¿‡ç¨‹å°†åœæ­¢ã€‚\nè¿è¡Œ cp3.goï¼Œä½ ä¼šå¾—åˆ°ä¸‹é¢çš„è¾“å‡ºï¼š\n$ go run cp3.go usage: cp3 source destination BUFFERSIZE $ go run cp3.go fileCP.txt /tmp/buf10 10 Copying fileCP.txt to /tmp/buf10 $ go run cp3.go fileCP.txt /tmp/buf20 20 Copying fileCP.txt to /tmp/buf20 åœ¨æ¥ä¸‹æ¥çš„åŸºå‡†æµ‹è¯•ä¸­ï¼Œä½ ä¼šå‘ç°ï¼Œç¼“å†²åŒºçš„å¤§å°æå¤§åœ°å½±å“äº† cp3.go çš„æ€§èƒ½ã€‚\nè¿è¡ŒåŸºå‡†æµ‹è¯• åœ¨æœ¬æ–‡çš„æœ€åä¸€éƒ¨åˆ†ï¼Œæˆ‘å°†å°è¯•æ¯”è¾ƒè¿™ä¸‰ä¸ªç¨‹åºä»¥åŠ cp3.go åœ¨ä¸åŒç¼“å†²åŒºå¤§å°ä¸‹çš„æ€§èƒ½ï¼ˆä½¿ç”¨ time(1) å‘½ä»¤è¡Œå·¥å…·ï¼‰ã€‚\nä»¥ä¸‹è¾“å‡ºæ˜¾ç¤ºäº†å¤åˆ¶ 500MB å¤§å°çš„æ–‡ä»¶æ—¶ï¼Œcp1.goã€cp2.go å’Œ cp3.go çš„æ€§èƒ½å¯¹æ¯”ï¼š\n$ ls -l INPUT -rw-r--r-- 1 mtsouk staff 512000000 Jun 5 09:39 INPUT $ time go run cp1.go INPUT /tmp/cp1 Copied 512000000 bytes! real 0m0.980s user 0m0.219s sys 0m0.719s $ time go run cp2.go INPUT /tmp/cp2 real 0m1.139s user 0m0.196s sys 0m0.654s $ time go run cp3.go INPUT /tmp/cp3 1000000 Copying INPUT to /tmp/cp3 real 0m1.025s user 0m0.195s sys 0m0.486s æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸‰ä¸ªç¨‹åºçš„æ€§èƒ½éå¸¸æ¥è¿‘ï¼Œè¿™æ„å‘³ç€ Go æ ‡å‡†åº“å‡½æ•°çš„å®ç°éå¸¸èªæ˜ã€ç»è¿‡äº†å……åˆ†ä¼˜åŒ–ã€‚\nç°åœ¨ï¼Œè®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ç¼“å†²åŒºå¤§å°å¯¹ cp3.go çš„æ€§èƒ½æœ‰ä»€ä¹ˆå½±å“å§ï¼æ‰§è¡Œ cp3.goï¼Œå¹¶åˆ†åˆ«æŒ‡å®šç¼“å†²åŒºå¤§å°ä¸º 10ã€20 å’Œ 1000 å­—èŠ‚ï¼Œåœ¨ä¸€å°è¿è¡Œå¾ˆå¿«çš„æœºå™¨ä¸Šå¤åˆ¶ 500MB æ–‡ä»¶ï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š\n$ ls -l INPUT -rw-r--r-- 1 mtsouk staff 512000000 Jun 5 09:39 INPUT $ time go run cp3.go INPUT /tmp/buf10 10 Copying INPUT to /tmp/buf10 real 6m39.721s user 1m18.457s sys 5m19.186s $ time go run cp3.go INPUT /tmp/buf20 20 Copying INPUT to /tmp/buf20 real 3m20.819s user 0m39.444s sys 2m40.380s $ time go run cp3.go INPUT /tmp/buf1000 1000 Copying INPUT to /tmp/buf1000 real 0m4.916s user 0m1.001s sys 0m3.986s æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œç¼“å†²åŒºè¶Šå¤§ï¼Œcp3.go è¿è¡Œå¾—å°±è¶Šå¿«ï¼Œè¿™æˆ–å¤šæˆ–å°‘æ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚æ­¤å¤–ï¼Œä½¿ç”¨å°äº 20 å­—èŠ‚çš„ç¼“å†²åŒºæ¥å¤åˆ¶å¤§æ–‡ä»¶ä¼šéå¸¸ç¼“æ…¢ï¼Œåº”è¯¥é¿å…ã€‚\nä½ å¯ä»¥åœ¨ GitHub æ‰¾åˆ° cp1.goã€cp2.go å’Œ cp3.go çš„ Go ä»£ç ã€‚\nå¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–åé¦ˆï¼Œè¯·åœ¨ï¼ˆåŸæ–‡ï¼‰ä¸‹æ–¹å‘è¡¨è¯„è®ºæˆ–åœ¨ Twitter ä¸Šä¸æˆ‘ï¼ˆåŸä½œè€…ï¼‰è”ç³»ã€‚\næœ¬æ–‡ä½¿ç”¨ CC BY-SA 4.0 å›½é™…åè®® è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿ éµç…§åè®®è§„å®š è½¬è½½ã€‚\né“¾æ¥ï¼šhttps://lkxed.github.io/posts/copying-files-go/ ä½œè€…ï¼šMihalis Tsoukalos / è¯‘è€…ï¼šå…­å¼€ç®± åŸæ–‡ï¼š3 ways to copy files in Go é¦–å‘ï¼šåœ¨ Go ä¸­å¤åˆ¶æ–‡ä»¶çš„ä¸‰ç§æ–¹æ³• @ Linux ä¸­å›½ ","wordCount":"1755","inLanguage":"zh","datePublished":"2022-05-31T15:34:27+08:00","dateModified":"2022-05-31T15:34:27+08:00","author":{"@type":"Person","name":"å…­å¼€ç®±"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lkxed.github.io/posts/copying-files-go/"},"publisher":{"@type":"Organization","name":"å…­å¼€ç®±","logo":{"@type":"ImageObject","url":"https://lkxed.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://lkxed.github.io/ accesskey=h title="å…­å¼€ç®± (Alt + H)"><img src=https://lkxed.github.io/favicon.ico alt=logo aria-label=logo height=30>å…­å¼€ç®±</a></div><ul id=menu><li><a href=https://lkxed.github.io/posts/ title=æ–‡ç« ><span>æ–‡ç« </span></a></li><li><a href=https://lkxed.github.io/archives/ title=å½’æ¡£><span>å½’æ¡£</span></a></li><li><a href=https://lkxed.github.io/series/ title=ç³»åˆ—><span>ç³»åˆ—</span></a></li><li><a href=https://lkxed.github.io/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://lkxed.github.io/search/ title="æœç´¢ (Alt + /)" accesskey=/><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>åœ¨ Go ä¸­å¤åˆ¶æ–‡ä»¶çš„ä¸‰ç§æ–¹æ³•</h1><div class=post-meta><span title='2022-05-31 15:34:27 +0800 CST'>2022 å¹´ 5 æœˆ 31 æ—¥ 15:34</span>&nbsp;Â·&nbsp;1755 å­—&nbsp;Â·&nbsp;å…­å¼€ç®±&nbsp;ï½œ&nbsp;<a href=https://github.com/lkxed/ rel="noopener noreferrer" target=_blank>å…³æ³¨æˆ‘ğŸŒŸ</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=å‰è¨€>å‰è¨€</a></li><li><a href=#%e6%96%b9%e6%b3%95%e4%b8%80%e4%bd%bf%e7%94%a8-iocopy aria-label="æ–¹æ³•ä¸€ï¼šä½¿ç”¨ io.Copy()">æ–¹æ³•ä¸€ï¼šä½¿ç”¨ io.Copy()</a></li><li><a href=#%e6%96%b9%e6%b3%95%e4%ba%8c%e4%bd%bf%e7%94%a8-ioutilwritefile-%e5%92%8c-ioutilreadfile aria-label="æ–¹æ³•äºŒï¼šä½¿ç”¨ ioutil.WriteFile() å’Œ ioutil.ReadFile()">æ–¹æ³•äºŒï¼šä½¿ç”¨ ioutil.WriteFile() å’Œ ioutil.ReadFile()</a></li><li><a href=#%e6%96%b9%e6%b3%95%e4%b8%89%e4%bd%bf%e7%94%a8-osread-%e5%92%8c-oswrite aria-label="æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ os.Read() å’Œ os.Write()">æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ os.Read() å’Œ os.Write()</a></li><li><a href=#%e8%bf%90%e8%a1%8c%e5%9f%ba%e5%87%86%e6%b5%8b%e8%af%95 aria-label=è¿è¡ŒåŸºå‡†æµ‹è¯•>è¿è¡ŒåŸºå‡†æµ‹è¯•</a></li></ul></div></details></div><div class=post-content><blockquote><p>æœ¬æ–‡æ˜¯ Go ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ï¼Œæˆ‘å°†ä»‹ç»ä¸‰ç§æœ€æµè¡Œçš„å¤åˆ¶æ–‡ä»¶çš„æ–¹æ³•ã€‚</p></blockquote><p><img loading=lazy src=https://img.linux.net.cn/data/attachment/album/202205/31/153413kcrth9v8c93r5u8e.jpg alt></p><h2 id=å‰è¨€>å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h2><p>æœ¬æ–‡å°†ä»‹ç»å±•ç¤ºå¦‚ä½•ä½¿ç”¨ <a href=https://golang.org/ target=_blank rel="noopener noreferrer">Go ç¼–ç¨‹è¯­è¨€</a>
æ¥å¤åˆ¶æ–‡ä»¶ã€‚åœ¨ Go ä¸­å¤åˆ¶æ–‡ä»¶çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæˆ‘åªä»‹ç»ä¸‰ç§æœ€å¸¸è§çš„ï¼šä½¿ç”¨ Go åº“ä¸­çš„ <code>io.Copy()</code> å‡½æ•°è°ƒç”¨ã€ä¸€æ¬¡è¯»å–è¾“å…¥æ–‡ä»¶å¹¶å°†å…¶å†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œä»¥åŠä½¿ç”¨ç¼“å†²åŒºä¸€å—å—åœ°å¤åˆ¶æ–‡ä»¶ã€‚</p><h2 id=æ–¹æ³•ä¸€ä½¿ç”¨-iocopy>æ–¹æ³•ä¸€ï¼šä½¿ç”¨ io.Copy()<a hidden class=anchor aria-hidden=true href=#æ–¹æ³•ä¸€ä½¿ç”¨-iocopy>#</a></h2><p>ç¬¬ä¸€ç§æ–¹æ³•å°±æ˜¯ä½¿ç”¨ Go æ ‡å‡†åº“çš„ <code>io.Copy()</code> å‡½æ•°ã€‚ä½ å¯ä»¥åœ¨ <code>copy()</code> å‡½æ•°çš„ä»£ç ä¸­æ‰¾åˆ°å®ƒçš„å®ç°é€»è¾‘ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre tabindex=0><code>func copy(src, dst string) (int64, error) {
  sourceFileStat, err := os.Stat(src)
  if err != nil {
    return 0, err
  }

  if !sourceFileStat.Mode().IsRegular() {
    return 0, fmt.Errorf(&#34;%s is not a regular file&#34;, src)
  }

  source, err := os.Open(src)
  if err != nil {
    return 0, err
  }
  defer source.Close()

  destination, err := os.Create(dst)
  if err != nil {
    return 0, err
  }
  defer destination.Close()
  nBytes, err := io.Copy(destination, source)
    return nBytes, err
  }
</code></pre><p>é¦–å…ˆï¼Œä¸Šè¿°ä»£ç åšäº†ä¸¤ä¸ªåˆ¤æ–­ï¼Œä»¥ä¾¿ç¡®å®šå®ƒå¯ä»¥è¢«æ‰“å¼€è¯»å–ï¼šä¸€æ˜¯åˆ¤æ–­å°†è¦å¤åˆ¶çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆ<code>os.Stat(src)</code>ï¼‰ï¼ŒäºŒæ˜¯åˆ¤æ–­å®ƒæ˜¯å¦ä¸ºå¸¸è§„æ–‡ä»¶ï¼ˆ<code>sourceFileStat.Mode().IsRegular()</code>ï¼‰ã€‚å‰©ä¸‹çš„æ‰€æœ‰å·¥ä½œéƒ½ç”± <code>io.Copy(destination, source)</code> è¿™è¡Œä»£ç æ¥å®Œæˆã€‚<code>io.Copy()</code> å‡½æ•°æ‰§è¡Œç»“æŸåï¼Œä¼šè¿”å›å¤åˆ¶çš„å­—èŠ‚æ•°å’Œå¤åˆ¶è¿‡ç¨‹ä¸­å‘ç”Ÿçš„ç¬¬ä¸€æ¡é”™è¯¯æ¶ˆæ¯ã€‚åœ¨ Go ä¸­ï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯æ¶ˆæ¯ï¼Œé”™è¯¯å˜é‡çš„å€¼å°±ä¸º <code>nil</code>ã€‚</p><p>ä½ å¯ä»¥åœ¨ <a href=https://golang.org/pkg/io/ target=_blank rel="noopener noreferrer">io åŒ…</a>
çš„æ–‡æ¡£é¡µé¢äº†è§£æœ‰å…³ <code>io.Copy()</code> å‡½æ•°çš„æ›´å¤šä¿¡æ¯ã€‚</p><p>è¿è¡Œ <code>cp1.go</code> å°†äº§ç”Ÿä»¥ä¸‹è¾“å‡ºï¼š</p><pre tabindex=0><code>$ go run cp1.go
Please provide two command line arguments!
$ go run cp1.go fileCP.txt /tmp/fileCPCOPY
Copied 3826 bytes!
$ diff fileCP.txt /tmp/fileCPCOPY
</code></pre><p>è¿™ä¸ªæ–¹æ³•å·²ç»éå¸¸ç®€å•äº†ï¼Œä¸è¿‡å®ƒæ²¡æœ‰ä¸ºå¼€å‘è€…æä¾›çµæ´»æ€§ã€‚è¿™å¹¶ä¸æ€»æ˜¯ä¸€ä»¶åäº‹ï¼Œä½†æ˜¯ï¼Œæœ‰äº›æ—¶å€™ï¼Œå¼€å‘è€…å¯èƒ½ä¼šéœ€è¦/æƒ³è¦å‘Šè¯‰ç¨‹åºè¯¥å¦‚ä½•è¯»å–æ–‡ä»¶ã€‚</p><h2 id=æ–¹æ³•äºŒä½¿ç”¨-ioutilwritefile-å’Œ-ioutilreadfile>æ–¹æ³•äºŒï¼šä½¿ç”¨ ioutil.WriteFile() å’Œ ioutil.ReadFile()<a hidden class=anchor aria-hidden=true href=#æ–¹æ³•äºŒä½¿ç”¨-ioutilwritefile-å’Œ-ioutilreadfile>#</a></h2><p>å¤åˆ¶æ–‡ä»¶çš„ç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨ <code>ioutil.ReadFile()</code> å’Œ <code>ioutil.WriteFile()</code> å‡½æ•°ã€‚ç¬¬ä¸€ä¸ªå‡½æ•°ç”¨äºå°†æ•´ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œä¸€æ¬¡æ€§åœ°è¯»å…¥åˆ°æŸä¸ªå†…å­˜ä¸­çš„å­—èŠ‚åˆ‡ç‰‡é‡Œï¼›ç¬¬äºŒä¸ªå‡½æ•°åˆ™ç”¨äºå°†å­—èŠ‚åˆ‡ç‰‡çš„å†…å®¹å†™å…¥åˆ°ä¸€ä¸ªç£ç›˜æ–‡ä»¶ä¸­ã€‚</p><p>å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><pre tabindex=0><code>input, err := ioutil.ReadFile(sourceFile)
if err != nil {
  fmt.Println(err)
  return
}

err = ioutil.WriteFile(destinationFile, input, 0644)
if err != nil {
  fmt.Println(&#34;Error creating&#34;, destinationFile)
  fmt.Println(err)
  return
}
</code></pre><p>ä¸Šè¿°ä»£ç åŒ…æ‹¬äº†ä¸¤ä¸ª <code>if</code> ä»£ç å—ï¼ˆå—¯ï¼Œç”¨ Go å†™ç¨‹åºå°±æ˜¯è¿™æ ·çš„ï¼‰ï¼Œç¨‹åºçš„å®é™…åŠŸèƒ½å…¶å®ä½“ç°åœ¨ <code>ioutil.ReadFile()</code> å’Œ <code>ioutil.WriteFile()</code> è¿™ä¸¤è¡Œä»£ç ä¸­ã€‚</p><p>è¿è¡Œ <code>cp2.go</code>ï¼Œä½ ä¼šå¾—åˆ°ä¸‹é¢çš„è¾“å‡ºï¼š</p><pre tabindex=0><code>$ go run cp2.go
Please provide two command line arguments!
$ go run cp2.go fileCP.txt /tmp/copyFileCP
$ diff fileCP.txt /tmp/copyFileCP
</code></pre><p>è¯·æ³¨æ„ï¼Œè™½ç„¶è¿™ç§æ–¹æ³•èƒ½å¤Ÿå®ç°æ–‡ä»¶å¤åˆ¶ï¼Œä½†å®ƒåœ¨å¤åˆ¶å¤§æ–‡ä»¶æ—¶çš„æ•ˆç‡å¯èƒ½ä¸é«˜ã€‚è¿™æ˜¯å› ä¸ºå½“æ–‡ä»¶å¾ˆå¤§æ—¶ï¼Œ<code>ioutil.ReadFile()</code> è¿”å›çš„å­—èŠ‚åˆ‡ç‰‡ä¼šå¾ˆå¤§ã€‚</p><h2 id=æ–¹æ³•ä¸‰ä½¿ç”¨-osread-å’Œ-oswrite>æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ os.Read() å’Œ os.Write()<a hidden class=anchor aria-hidden=true href=#æ–¹æ³•ä¸‰ä½¿ç”¨-osread-å’Œ-oswrite>#</a></h2><p>åœ¨ Go ä¸­å¤åˆ¶æ–‡ä»¶çš„ç¬¬ä¸‰ç§æ–¹æ³•å°±æ˜¯ä¸‹é¢è¦ä»‹ç»çš„ <code>cp3.go</code>ã€‚å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼šè¾“å…¥æ–‡ä»¶åã€è¾“å‡ºæ–‡ä»¶åå’Œç¼“å†²åŒºå¤§å°ã€‚</p><p><code>cp3.go</code> æœ€é‡è¦çš„éƒ¨åˆ†ä½äºä»¥ä¸‹ <code>for</code> å¾ªç¯ä¸­ï¼Œä½ å¯ä»¥åœ¨ <code>copy()</code> å‡½æ•°ä¸­æ‰¾åˆ°å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre tabindex=0><code>buf := make([]byte, BUFFERSIZE)
for {
  n, err := source.Read(buf)
  if err != nil &amp;&amp; err != io.EOF {
    return err
  }
  if n == 0 {
    break
  }

  if _, err := destination.Write(buf[:n]); err != nil {
    return err
  }
}
</code></pre><p>è¯¥æ–¹æ³•ä½¿ç”¨ <code>os.Read()</code> å°†è¾“å…¥æ–‡ä»¶çš„ä¸€å°éƒ¨åˆ†è¯»å…¥åä¸º <code>buf</code> çš„ç¼“å†²åŒºï¼Œç„¶åä½¿ç”¨ <code>os.Write()</code> å°†è¯¥ç¼“å†²åŒºçš„å†…å®¹å†™å…¥æ–‡ä»¶ã€‚å½“è¯»å–å‡ºé”™æˆ–åˆ°è¾¾æ–‡ä»¶æœ«å°¾ï¼ˆ<code>io.EOF</code>ï¼‰æ—¶ï¼Œå¤åˆ¶è¿‡ç¨‹å°†åœæ­¢ã€‚</p><p>è¿è¡Œ <code>cp3.go</code>ï¼Œä½ ä¼šå¾—åˆ°ä¸‹é¢çš„è¾“å‡ºï¼š</p><pre tabindex=0><code>$ go run cp3.go
usage: cp3 source destination BUFFERSIZE
$ go run cp3.go fileCP.txt /tmp/buf10 10
Copying fileCP.txt to /tmp/buf10
$ go run cp3.go fileCP.txt /tmp/buf20 20
Copying fileCP.txt to /tmp/buf20
</code></pre><p>åœ¨æ¥ä¸‹æ¥çš„åŸºå‡†æµ‹è¯•ä¸­ï¼Œä½ ä¼šå‘ç°ï¼Œç¼“å†²åŒºçš„å¤§å°æå¤§åœ°å½±å“äº† <code>cp3.go</code> çš„æ€§èƒ½ã€‚</p><h2 id=è¿è¡ŒåŸºå‡†æµ‹è¯•>è¿è¡ŒåŸºå‡†æµ‹è¯•<a hidden class=anchor aria-hidden=true href=#è¿è¡ŒåŸºå‡†æµ‹è¯•>#</a></h2><p>åœ¨æœ¬æ–‡çš„æœ€åä¸€éƒ¨åˆ†ï¼Œæˆ‘å°†å°è¯•æ¯”è¾ƒè¿™ä¸‰ä¸ªç¨‹åºä»¥åŠ <code>cp3.go</code> åœ¨ä¸åŒç¼“å†²åŒºå¤§å°ä¸‹çš„æ€§èƒ½ï¼ˆä½¿ç”¨ <code>time(1)</code> å‘½ä»¤è¡Œå·¥å…·ï¼‰ã€‚</p><p>ä»¥ä¸‹è¾“å‡ºæ˜¾ç¤ºäº†å¤åˆ¶ 500MB å¤§å°çš„æ–‡ä»¶æ—¶ï¼Œ<code>cp1.go</code>ã€<code>cp2.go</code> å’Œ <code>cp3.go</code> çš„æ€§èƒ½å¯¹æ¯”ï¼š</p><pre tabindex=0><code>$ ls -l INPUT
-rw-r--r--  1 mtsouk  staff  512000000 Jun  5 09:39 INPUT
$ time go run cp1.go INPUT /tmp/cp1
Copied 512000000 bytes!

real    0m0.980s
user    0m0.219s
sys     0m0.719s
$ time go run cp2.go INPUT /tmp/cp2

real    0m1.139s
user    0m0.196s
sys     0m0.654s
$ time go run cp3.go INPUT /tmp/cp3 1000000
Copying INPUT to /tmp/cp3

real    0m1.025s
user    0m0.195s
sys     0m0.486s
</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸‰ä¸ªç¨‹åºçš„æ€§èƒ½éå¸¸æ¥è¿‘ï¼Œè¿™æ„å‘³ç€ Go æ ‡å‡†åº“å‡½æ•°çš„å®ç°éå¸¸èªæ˜ã€ç»è¿‡äº†å……åˆ†ä¼˜åŒ–ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ç¼“å†²åŒºå¤§å°å¯¹ <code>cp3.go</code> çš„æ€§èƒ½æœ‰ä»€ä¹ˆå½±å“å§ï¼æ‰§è¡Œ <code>cp3.go</code>ï¼Œå¹¶åˆ†åˆ«æŒ‡å®šç¼“å†²åŒºå¤§å°ä¸º 10ã€20 å’Œ 1000 å­—èŠ‚ï¼Œåœ¨ä¸€å°è¿è¡Œå¾ˆå¿«çš„æœºå™¨ä¸Šå¤åˆ¶ 500MB æ–‡ä»¶ï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š</p><pre tabindex=0><code>$ ls -l INPUT
-rw-r--r--  1 mtsouk  staff  512000000 Jun  5 09:39 INPUT
$ time go run cp3.go INPUT /tmp/buf10 10
Copying INPUT to /tmp/buf10

real    6m39.721s
user    1m18.457s
sys 5m19.186s
$ time go run cp3.go INPUT /tmp/buf20 20
Copying INPUT to /tmp/buf20

real    3m20.819s
user    0m39.444s
sys 2m40.380s
$ time go run cp3.go INPUT /tmp/buf1000 1000
Copying INPUT to /tmp/buf1000

real    0m4.916s
user    0m1.001s
sys     0m3.986s
</code></pre><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œç¼“å†²åŒºè¶Šå¤§ï¼Œ<code>cp3.go</code> è¿è¡Œå¾—å°±è¶Šå¿«ï¼Œè¿™æˆ–å¤šæˆ–å°‘æ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚æ­¤å¤–ï¼Œä½¿ç”¨å°äº 20 å­—èŠ‚çš„ç¼“å†²åŒºæ¥å¤åˆ¶å¤§æ–‡ä»¶ä¼šéå¸¸ç¼“æ…¢ï¼Œåº”è¯¥é¿å…ã€‚</p><p>ä½ å¯ä»¥åœ¨ <a href=https://github.com/mactsouk/opensource.com target=_blank rel="noopener noreferrer">GitHub</a>
æ‰¾åˆ° <code>cp1.go</code>ã€<code>cp2.go</code> å’Œ <code>cp3.go</code> çš„ Go ä»£ç ã€‚</p><p>å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–åé¦ˆï¼Œè¯·åœ¨ï¼ˆåŸæ–‡ï¼‰ä¸‹æ–¹å‘è¡¨è¯„è®ºæˆ–åœ¨ <a href=https://twitter.com/mactsouk target=_blank rel="noopener noreferrer">Twitter</a>
ä¸Šä¸æˆ‘ï¼ˆåŸä½œè€…ï¼‰è”ç³»ã€‚</p><hr><blockquote><p>æœ¬æ–‡ä½¿ç”¨ <a href=https://creativecommons.org/licenses/by-sa/4.0/deed.zh target=_blank rel="noopener noreferrer">CC BY-SA 4.0 å›½é™…åè®®</a>
è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿ <strong>éµç…§åè®®è§„å®š</strong> è½¬è½½ã€‚<br>é“¾æ¥ï¼š<a href=https://lkxed.github.io/posts/copying-files-go/ target=_blank rel="noopener noreferrer">https://lkxed.github.io/posts/copying-files-go/</a><br>ä½œè€…ï¼š<a href=https://opensource.com/users/mtsouk target=_blank rel="noopener noreferrer">Mihalis Tsoukalos</a>
/ è¯‘è€…ï¼š<a href=https://github.com/lkxed/ target=_blank rel="noopener noreferrer">å…­å¼€ç®±</a><br>åŸæ–‡ï¼š<a href=https://opensource.com/article/18/6/copying-files-go target=_blank rel="noopener noreferrer">3 ways to copy files in Go</a><br>é¦–å‘ï¼š<a href=https://linux.cn/article-14658-1.html target=_blank rel="noopener noreferrer">åœ¨ Go ä¸­å¤åˆ¶æ–‡ä»¶çš„ä¸‰ç§æ–¹æ³•</a>
@ <a href=https://linux.cn/ target=_blank rel="noopener noreferrer">Linux ä¸­å›½</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://lkxed.github.io/tags/%E8%AF%91%E6%96%87/>è¯‘æ–‡</a></li><li><a href=https://lkxed.github.io/tags/%E7%A7%AF%E6%B0%B4/>ç§¯æ°´</a></li><li><a href=https://lkxed.github.io/tags/go/>Go</a></li><li><a href=https://lkxed.github.io/tags/%E6%95%99%E7%A8%8B/>æ•™ç¨‹</a></li></ul><nav class=paginav><a class=prev href=https://lkxed.github.io/posts/plex-desktop-linux/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Plex æ¡Œé¢æ’­æ”¾å™¨ç°å·²æ”¯æŒ Linux</span></a>
<a class=next href=https://lkxed.github.io/posts/tails-tor-browser/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>Tails è­¦å‘Šç”¨æˆ·ä¸è¦ä½¿ç”¨ Tor æµè§ˆå™¨ï¼šåŸå› å¦‚ä¸‹ï¼</span></a></nav></footer><script src=https://giscus.app/client.js data-repo=lkxed/lkxed.github.io data-repo-id=R_kgDOHF00eA data-category=Announcements data-category-id=DIC_kwDOHF00eM4COXzh data-mapping=og:title data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><div class=social-icons><a href=https://github.com/lkxed/ target=_blank rel="noopener noreferrer me" title=GitHub><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://space.bilibili.com/88033726/ target=_blank rel="noopener noreferrer me" title=Bilibili><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" xmlns="http://www.w3.org/2000/svg"><rect x="1.3333" y="6" width="21.333" height="15.333" rx="4" ry="4"/><path d="m8 12.4v1.2"/><path d="m16 12.4v1.2"/><path d="m5.8853 2.6667L8.552 5.3334"/><path d="m18.115 2.6667-2.6667 2.6667"/></svg></a></div><span>&copy; 2022 <a href=https://lkxed.github.io/>å…­å¼€ç®±</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/lkxed/hugo-PaperMod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="å¤åˆ¶";function s(){t.innerText="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerText="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>