<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Gitbase：使用 SQL 探索 Git 仓库｜六开箱</title><meta name=keywords content="代码搜索,Go"><meta name=description content="Gitbase 是一个由 Go 驱动的开源项目，它使得我们可以在 Git 仓库上运行 SQL 查询。"><meta name=author content="六开箱"><link rel=canonical href=https://lkxed.github.io/posts/gitbase/><link crossorigin=anonymous href=/assets/css/stylesheet.min.09b98575a0a9c52a0dcff6660328188f9365049be8c47253f3072a85d10d82a5.css integrity="sha256-CbmFdaCpxSoNz/ZmAygYj5NlBJvoxHJT8wcqhdENgqU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://lkxed.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lkxed.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lkxed.github.io/favicon-32x32.png><link rel=manifest href=https://lkxed.github.io/site.webmanifest><link rel=apple-touch-icon href=https://lkxed.github.io/apple-touch-icon.png><link rel=mask-icon href=https://lkxed.github.io/safari-pinned-tab.svg><meta name=theme-color content="#f5f5f5" media="(prefers-color-scheme: light)"><meta name=theme-color content="#1d1e20" media="(prefers-color-scheme: dark)"><meta name=msapplication-TileColor content="#ffffff"><noscript><style>.top-link{display:none}</style></noscript><meta name=shenma-site-verification content="0834e815906a93375245a759f409f8b0_1648880760"><meta name=baidu-site-verification content="code-2I1Hg4GETM"><meta name=google-site-verification content="QWaJU9oM7UFAshQEDkcyAZivnI9b6iIOR59kso4I_QE"><meta property="og:title" content="Gitbase：使用 SQL 探索 Git 仓库"><meta property="og:description" content="Gitbase 是一个由 Go 驱动的开源项目，它使得我们可以在 Git 仓库上运行 SQL 查询。"><meta property="og:type" content="article"><meta property="og:url" content="https://lkxed.github.io/posts/gitbase/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-20T22:29:23+08:00"><meta property="article:modified_time" content="2022-04-20T22:29:23+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Gitbase：使用 SQL 探索 Git 仓库"><meta name=twitter:description content="Gitbase 是一个由 Go 驱动的开源项目，它使得我们可以在 Git 仓库上运行 SQL 查询。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"文章","item":"https://lkxed.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Gitbase：使用 SQL 探索 Git 仓库","item":"https://lkxed.github.io/posts/gitbase/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Gitbase：使用 SQL 探索 Git 仓库","name":"Gitbase：使用 SQL 探索 Git 仓库","description":"Gitbase 是一个由 Go 驱动的开源项目，它使得我们可以在 Git 仓库上运行 SQL 查询。","keywords":["代码搜索","Go"],"articleBody":" Gitbase 是一个由 Go 驱动的开源项目，它使得我们可以在 Git 仓库上运行 SQL 查询。\n 前言 Git 已经成为了代码版本控制的事实标准。虽然 Git 已经很流行了，但想用它来对源代码仓库的历史和内容进行深度分析，仍然是一件复杂的事情。\n另一方面，SQL 则是一个经过实际检验、适合查询大型代码库的的语言，毕竟 Spark 和 BigQuery 等项目都采用了 SQL 作为查询语言。\n因此，在 source{d} 公司，我们顺理成章地结合了这两种技术来创建了 Gitbase：这是一个用 SQL 对 Git 仓库进行大规模分析的“代码即数据”解决方案。\nGitbase 是一个完全开源的项目，它站在一系列巨人的肩膀上，是它们使 Gitbase 的发展成为可能。本文旨在指出其中的主要部分。\nGitbase 试验场 提供了一种使用 Gitbase 的可视化方式。\n使用 Vitess 解析 SQL Gitbase 将 SQL 作为用户接口。这意味着我们需要解析基于 MySQL 协议传输的 SQL 请求，并理解它们。幸运的是，我们在 YouTube 的朋友和他们的 Vitess 项目已经实现了这一点。Vitess 是一个数据库集群系统，用于 MySQL 的水平扩展。\n我们直接截取一些重要的代码片段，并把它做成了一个 开源项目 。这个项目允许任何人在几分钟内编写一个 MySQL 服务器（正如我在 justforfunc 的专题：CSVQL - 用 SQL 处理 CSV 中所展示的那样）。\n用 go-git 读取 Git 储存库 当成功解析了一个请求，我们还需要读取数据集里的 Git 仓库，才能够知道该如何回复它。为此，我们集成了 source{d} 最成功的仓库 go-git 。go-git 是一个高度可扩展的纯 Go 语言的 Git 实现。\n这使得我们能够轻松地分析以 siva 文件格式存储在磁盘上的源代码仓库（siva 也是一个 source{d} 的开源项目），或是直接使用 git clone 克隆的仓库。\n使用 Enry 检测编程语言，使用 Babelfish 解析文件 Gitbase 并没有将其分析能力局限于 Git 历史记录上。它还使用（显然也是）我们的开源项目 Enry 集成了语言检测功能，并使用 Babelfish 实现了程序解析的功能。Babelfish 是一个用于通用源代码解析的自托管服务器，它可以将代码文件转化为通用抽象语法树Universal Abstract Syntax Trees（UAST）。\n这两个功能在 Gitbase 中呈现为用户函数 LANGUAGE 和 UAST。结合使用两个函数，许多查询请求都成为了可能，比如“找到上个月修改次数最多的函数名称”。\n让它快速运行 Gitbase 经常要分析非常大的数据集，比如公共 Git 档案，其中有来自 GitHub 的 3TB 源代码（见 公告 ）。为了做到这一点，每份 CPU 处理能力都很重要。\n这就是为什么我们又集成了另外两个项目：Rubex 和 Pilosa。\n使用 Rubex 和 Oniguruma 加快正则表达式的速度 Rubex 是 Go 的 regexp 标准库包的一个准替代品。之所以还不能完成替代，是因为他们没有在 regexp.Regexp 类型上实现 LiteralPrefix 方法，不过我也是直到现在才听说这个方法。\nRubex 的高性能得归功于高度优化的 C 语言库 Oniguruma ，它使用 cgo 来调用这个库。\n使用 Pilosa 索引加快查询速度 索引基本上是每个关系型数据库的众所周知的特性，但 Vitess 却没有实现索引，因为它不是真正需要。\n还好开源的 Pilosa 再一次拯救了我们，它是一个用 Go 实现的分布式位图索引，使得 Gitbase 可以用于大规模的数据集。Pilosa 是开源的，它极大地加快了对多个海量数据集的查询。\n总结 我想通过这篇博文，亲自感谢开源社区，是他们让我们在如此短的时间内创建了 Gitbase，这是谁也没想到的。在 source{d} 公司，我们是开源的坚定信仰者，github.com/src-d 下的每一行代码（包括我们的 OKR 和投资者委员会）都可以证明这一点。\n你想尝试一下 Gitbase 吗？最快、最简单的方法就是使用 source{d} 引擎。从 sourced.tech/engine 下载它，只需一个命令就能让 Gitbase 运行起来。\n想了解更多吗？请查看我在 Go SF meetup 的演讲录音。\n这篇文章 最初发表在 Medium 上，经授权后在此重新发布。\n  转载须知：本文遵循 CC BY-SA 4.0 许可协议 链接：https://lkxed.github.io/posts/gitbase/ 作者：Francesc Campoy / 译者：六开箱 原文：Gitbase: Exploring Git repos with SQL 首发：Gitbase：使用 SQL 探索 Git 仓库 @ Linux 中国  ","wordCount":"1490","inLanguage":"zh","datePublished":"2022-04-20T22:29:23+08:00","dateModified":"2022-04-20T22:29:23+08:00","author":{"@type":"Person","name":"六开箱"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lkxed.github.io/posts/gitbase/"},"publisher":{"@type":"Organization","name":"六开箱","logo":{"@type":"ImageObject","url":"https://lkxed.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://lkxed.github.io/ accesskey=h title="六开箱 (Alt + H)"><img src=https://lkxed.github.io/favicon.ico alt=logo aria-label=logo height=30>六开箱</a></div><ul id=menu><li><a href=https://lkxed.github.io/posts/ title=文章><span>文章</span></a></li><li><a href=https://lkxed.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://lkxed.github.io/series/ title=系列><span>系列</span></a></li><li><a href=https://lkxed.github.io/tags/ title=标签><span>标签</span></a></li><li><a href=https://lkxed.github.io/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Gitbase：使用 SQL 探索 Git 仓库</h1><div class=post-meta><span title="2022-04-20 22:29:23 +0800 CST">2022 年 4 月 20 日</span>&nbsp;·&nbsp;1490 字&nbsp;·&nbsp;六开箱&nbsp;｜&nbsp;<a href=https://github.com/lkxed/ rel="noopener noreferrer" target=_blank>关注我🌟</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=前言>前言</a></li><li><a href=#%e4%bd%bf%e7%94%a8-vitess-%e8%a7%a3%e6%9e%90-sql aria-label="使用 Vitess 解析 SQL">使用 Vitess 解析 SQL</a></li><li><a href=#%e7%94%a8-go-git-%e8%af%bb%e5%8f%96-git-%e5%82%a8%e5%ad%98%e5%ba%93 aria-label="用 go-git 读取 Git 储存库">用 go-git 读取 Git 储存库</a></li><li><a href=#%e4%bd%bf%e7%94%a8-enry-%e6%a3%80%e6%b5%8b%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80%e4%bd%bf%e7%94%a8-babelfish-%e8%a7%a3%e6%9e%90%e6%96%87%e4%bb%b6 aria-label="使用 Enry 检测编程语言，使用 Babelfish 解析文件">使用 Enry 检测编程语言，使用 Babelfish 解析文件</a></li><li><a href=#%e8%ae%a9%e5%ae%83%e5%bf%ab%e9%80%9f%e8%bf%90%e8%a1%8c aria-label=让它快速运行>让它快速运行</a></li><li><a href=#%e4%bd%bf%e7%94%a8-rubex-%e5%92%8c-oniguruma-%e5%8a%a0%e5%bf%ab%e6%ad%a3%e5%88%99%e8%a1%a8%e8%be%be%e5%bc%8f%e7%9a%84%e9%80%9f%e5%ba%a6 aria-label="使用 Rubex 和 Oniguruma 加快正则表达式的速度">使用 Rubex 和 Oniguruma 加快正则表达式的速度</a></li><li><a href=#%e4%bd%bf%e7%94%a8-pilosa-%e7%b4%a2%e5%bc%95%e5%8a%a0%e5%bf%ab%e6%9f%a5%e8%af%a2%e9%80%9f%e5%ba%a6 aria-label="使用 Pilosa 索引加快查询速度">使用 Pilosa 索引加快查询速度</a></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=总结>总结</a></li></ul></div></details></div><div class=post-content><blockquote><p>Gitbase 是一个由 Go 驱动的开源项目，它使得我们可以在 Git 仓库上运行 SQL 查询。</p></blockquote><p><img loading=lazy src=https://img.linux.net.cn/data/attachment/album/202204/13/230432g3s0su4ujozmezi2.png alt></p><h2 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h2><p>Git 已经成为了代码版本控制的事实标准。虽然 Git 已经很流行了，但想用它来对源代码仓库的历史和内容进行深度分析，仍然是一件复杂的事情。</p><p>另一方面，SQL 则是一个经过实际检验、适合查询大型代码库的的语言，毕竟 Spark 和 BigQuery 等项目都采用了 SQL 作为查询语言。</p><p>因此，在 source{d} 公司，我们顺理成章地结合了这两种技术来创建了 Gitbase：这是一个用 SQL 对 Git 仓库进行大规模分析的“代码即数据”解决方案。</p><p><a href=https://github.com/src-d/gitbase target=_blank rel="noopener noreferrer">Gitbase</a>
是一个完全开源的项目，它站在一系列巨人的肩膀上，是它们使 Gitbase 的发展成为可能。本文旨在指出其中的主要部分。</p><p><img loading=lazy src=https://opensource.com/sites/default/files/uploads/gitbase.png alt></p><p><em><a href=https://github.com/src-d/gitbase-web target=_blank rel="noopener noreferrer">Gitbase 试验场</a>
提供了一种使用 Gitbase 的可视化方式。</em></p><h2 id=使用-vitess-解析-sql>使用 Vitess 解析 SQL<a hidden class=anchor aria-hidden=true href=#使用-vitess-解析-sql>#</a></h2><p>Gitbase 将 SQL 作为用户接口。这意味着我们需要解析基于 MySQL 协议传输的 SQL 请求，并理解它们。幸运的是，我们在 YouTube 的朋友和他们的 <a href=https://github.com/vitessio/vitess target=_blank rel="noopener noreferrer">Vitess</a>
项目已经实现了这一点。Vitess 是一个数据库集群系统，用于 MySQL 的水平扩展。</p><p>我们直接截取一些重要的代码片段，并把它做成了一个 <a href=https://github.com/src-d/go-mysql-server target=_blank rel="noopener noreferrer">开源项目</a>
。这个项目允许任何人在几分钟内编写一个 MySQL 服务器（正如我在 <a href=http://justforfunc.com/ target=_blank rel="noopener noreferrer">justforfunc</a>
的专题：<a href=https://youtu.be/bcRDXAraprk target=_blank rel="noopener noreferrer">CSVQL - 用 SQL 处理 CSV</a>
中所展示的那样）。</p><h2 id=用-go-git-读取-git-储存库>用 go-git 读取 Git 储存库<a hidden class=anchor aria-hidden=true href=#用-go-git-读取-git-储存库>#</a></h2><p>当成功解析了一个请求，我们还需要读取数据集里的 Git 仓库，才能够知道该如何回复它。为此，我们集成了 source{d} 最成功的仓库 <a href=https://github.com/src-d/go-git target=_blank rel="noopener noreferrer">go-git</a>
。go-git 是一个高度可扩展的纯 Go 语言的 Git 实现。</p><p>这使得我们能够轻松地分析以 <a href=https://github.com/src-d/siva target=_blank rel="noopener noreferrer">siva</a>
文件格式存储在磁盘上的源代码仓库（siva 也是一个 source{d} 的开源项目），或是直接使用 <code>git clone</code> 克隆的仓库。</p><h2 id=使用-enry-检测编程语言使用-babelfish-解析文件>使用 Enry 检测编程语言，使用 Babelfish 解析文件<a hidden class=anchor aria-hidden=true href=#使用-enry-检测编程语言使用-babelfish-解析文件>#</a></h2><p>Gitbase 并没有将其分析能力局限于 Git 历史记录上。它还使用（显然也是）我们的开源项目 <a href=https://github.com/src-d/enry target=_blank rel="noopener noreferrer">Enry</a>
集成了语言检测功能，并使用 <a href=https://github.com/bblfsh/bblfshd target=_blank rel="noopener noreferrer">Babelfish</a>
实现了程序解析的功能。Babelfish 是一个用于通用源代码解析的自托管服务器，它可以将代码文件转化为<ruby>通用抽象语法树<rt>Universal Abstract Syntax Trees</rt></ruby>（UAST）。</p><p>这两个功能在 Gitbase 中呈现为用户函数 <code>LANGUAGE</code> 和 <code>UAST</code>。结合使用两个函数，许多查询请求都成为了可能，比如“找到上个月修改次数最多的函数名称”。</p><h2 id=让它快速运行>让它快速运行<a hidden class=anchor aria-hidden=true href=#让它快速运行>#</a></h2><p>Gitbase 经常要分析非常大的数据集，比如公共 Git 档案，其中有来自 GitHub 的 3TB 源代码（见 <a href=https://blog.sourced.tech/post/announcing-pga/ target=_blank rel="noopener noreferrer">公告</a>
）。为了做到这一点，每份 CPU 处理能力都很重要。</p><p>这就是为什么我们又集成了另外两个项目：Rubex 和 Pilosa。</p><h2 id=使用-rubex-和-oniguruma-加快正则表达式的速度>使用 Rubex 和 Oniguruma 加快正则表达式的速度<a hidden class=anchor aria-hidden=true href=#使用-rubex-和-oniguruma-加快正则表达式的速度>#</a></h2><p><a href=https://github.com/moovweb/rubex target=_blank rel="noopener noreferrer">Rubex</a>
是 Go 的 <code>regexp</code> 标准库包的一个准替代品。之所以还不能完成替代，是因为他们没有在 <code>regexp.Regexp</code> 类型上实现 <code>LiteralPrefix</code> 方法，不过我也是直到现在才听说这个方法。</p><p>Rubex 的高性能得归功于高度优化的 C 语言库 <a href=https://github.com/kkos/oniguruma target=_blank rel="noopener noreferrer">Oniguruma</a>
，它使用 <a href=https://golang.org/cmd/cgo/ target=_blank rel="noopener noreferrer">cgo</a>
来调用这个库。</p><h2 id=使用-pilosa-索引加快查询速度>使用 Pilosa 索引加快查询速度<a hidden class=anchor aria-hidden=true href=#使用-pilosa-索引加快查询速度>#</a></h2><p>索引基本上是每个关系型数据库的众所周知的特性，但 Vitess 却没有实现索引，因为它不是真正需要。</p><p>还好开源的 <a href=https://github.com/pilosa/pilosa target=_blank rel="noopener noreferrer">Pilosa</a>
再一次拯救了我们，它是一个用 Go 实现的分布式位图索引，使得 Gitbase 可以用于大规模的数据集。Pilosa 是开源的，它极大地加快了对多个海量数据集的查询。</p><h2 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h2><p>我想通过这篇博文，亲自感谢开源社区，是他们让我们在如此短的时间内创建了 Gitbase，这是谁也没想到的。在 source{d} 公司，我们是开源的坚定信仰者，<code>github.com/src-d</code> 下的每一行代码（包括我们的 OKR 和投资者委员会）都可以证明这一点。</p><p>你想尝试一下 Gitbase 吗？最快、最简单的方法就是使用 source{d} 引擎。从 <code>sourced.tech/engine</code> 下载它，只需一个命令就能让 Gitbase 运行起来。</p><p>想了解更多吗？请查看我在 <a href=https://www.meetup.com/golangsf/events/251690574/ target=_blank rel="noopener noreferrer">Go SF meetup</a>
的演讲录音。</p><p>这篇文章 <a href=https://medium.com/sourcedtech/gitbase-exploring-git-repos-with-sql-95ec0986386c target=_blank rel="noopener noreferrer">最初发表在</a>
Medium 上，经授权后在此重新发布。</p><hr><blockquote><p>转载须知：本文遵循 <a href=https://creativecommons.org/licenses/by-sa/4.0/deed.zh target=_blank rel="noopener noreferrer">CC BY-SA 4.0 许可协议</a><br>链接：<a href=https://lkxed.github.io/posts/gitbase/ target=_blank rel="noopener noreferrer">https://lkxed.github.io/posts/gitbase/</a><br>作者：<a href=https://opensource.com/users/francesc/ target=_blank rel="noopener noreferrer">Francesc Campoy</a>
/ 译者：<a href=https://github.com/lkxed/ target=_blank rel="noopener noreferrer">六开箱</a><br>原文：<a href=https://opensource.com/article/18/11/gitbase target=_blank rel="noopener noreferrer">Gitbase: Exploring Git repos with SQL</a><br>首发：<a href=https://linux.cn/article-14470-1.html target=_blank rel="noopener noreferrer">Gitbase：使用 SQL 探索 Git 仓库</a>
@ <a href=https://linux.cn/ target=_blank rel="noopener noreferrer">Linux 中国</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://lkxed.github.io/tags/%E8%AF%91%E6%96%87/>译文</a></li><li><a href=https://lkxed.github.io/tags/%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/>开源软件</a></li><li><a href=https://lkxed.github.io/tags/%E4%BB%A3%E7%A0%81%E6%90%9C%E7%B4%A2/>代码搜索</a></li><li><a href=https://lkxed.github.io/tags/go/>Go</a></li><li><a href=https://lkxed.github.io/tags/%E7%AE%80%E4%BB%8B/>简介</a></li></ul><nav class=paginav><a class=next href=https://lkxed.github.io/posts/elon-musk-twitter-open-source/><span class=title>下一页 »</span><br><span>埃隆·马斯克：推特的算法应该开源</span></a></nav></footer><script src=https://giscus.app/client.js data-repo=lkxed/lkxed.github.io data-repo-id=R_kgDOHF00eA data-category=Announcements data-category-id=DIC_kwDOHF00eM4COXzh data-mapping=og:title data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><div class=social-icons><a href=https://github.com/lkxed/ target=_blank rel="noopener noreferrer me" title=GitHub><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://space.bilibili.com/88033726/ target=_blank rel="noopener noreferrer me" title=Bilibili><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" xmlns="http://www.w3.org/2000/svg"><rect x="1.3333" y="6" width="21.333" height="15.333" rx="4" ry="4"/><path d="m8 12.4v1.2"/><path d="m16 12.4v1.2"/><path d="m5.8853 2.6667L8.552 5.3334"/><path d="m18.115 2.6667-2.6667 2.6667"/></svg></a></div><span>&copy; 2022 <a href=https://lkxed.github.io/>六开箱</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/lkxed/hugo-PaperMod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="复制";function s(){e.innerText="已复制！",setTimeout(()=>{e.innerText="复制"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>