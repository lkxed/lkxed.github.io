<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>使用 Java 解析 XML 文件｜六开箱</title><meta name=keywords content="Java,XML,解析,parse,教程"><meta name=description content="在你使用 Java 编写软件时实现持久化配置。"><meta name=author content="六开箱"><link rel=canonical href=https://lkxed.github.io/posts/parsing-xml-java/><link crossorigin=anonymous href=/assets/css/stylesheet.min.09b98575a0a9c52a0dcff6660328188f9365049be8c47253f3072a85d10d82a5.css integrity="sha256-CbmFdaCpxSoNz/ZmAygYj5NlBJvoxHJT8wcqhdENgqU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://lkxed.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lkxed.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lkxed.github.io/favicon-32x32.png><link rel=manifest href=https://lkxed.github.io/site.webmanifest><link rel=apple-touch-icon href=https://lkxed.github.io/apple-touch-icon.png><link rel=mask-icon href=https://lkxed.github.io/safari-pinned-tab.svg><meta name=theme-color content="#f5f5f5" media="(prefers-color-scheme: light)"><meta name=theme-color content="#1d1e20" media="(prefers-color-scheme: dark)"><meta name=msapplication-TileColor content="#ffffff"><noscript><style>.top-link{display:none}</style></noscript><meta name=shenma-site-verification content="0834e815906a93375245a759f409f8b0_1648880760"><meta name=baidu-site-verification content="code-2I1Hg4GETM"><meta name=google-site-verification content="xBkkt93v_nso_R-2aQ-An4rbc_Gi_4rNFi8oBEKDNjc"><meta property="og:title" content="使用 Java 解析 XML 文件"><meta property="og:description" content="在你使用 Java 编写软件时实现持久化配置。"><meta property="og:type" content="article"><meta property="og:url" content="https://lkxed.github.io/posts/parsing-xml-java/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-22T09:16:56+08:00"><meta property="article:modified_time" content="2022-03-22T09:16:56+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用 Java 解析 XML 文件"><meta name=twitter:description content="在你使用 Java 编写软件时实现持久化配置。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"文章","item":"https://lkxed.github.io/posts/"},{"@type":"ListItem","position":2,"name":"使用 Java 解析 XML 文件","item":"https://lkxed.github.io/posts/parsing-xml-java/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"使用 Java 解析 XML 文件","name":"使用 Java 解析 XML 文件","description":"在你使用 Java 编写软件时实现持久化配置。","keywords":["Java","XML","解析","parse","教程"],"articleBody":" 在你使用 Java 编写软件时实现持久化配置。\n 前言 当你编写一个应用时，你通常都会希望用户能够定制化他们和应用交互的方式，以及应用与系统进行交互的方式。这种方式通常被称为 “偏好preference” 或者 “设置setting”，它们被保存在一个 “偏好文件” 或者 “配置文件” 中，有时也直接简称为 “配置config”。配置文件可以有很多种格式，包括 INI、JSON、YAML 和 XML。每一种编程语言解析这些格式的方式都不同。本文主要讨论，当你在使用 Java 编程语言 来编写软件时，实现持久化配置的方式。\n选择一个格式 编写配置文件是一件相当复杂的事情。我曾经试过把配置项使用逗号分隔保存在一个文本文件里，也试过把配置项保存在非常详细的 YAML 和 XML 中。对于配置文件来说，最重要是要有一致性和规律性，它们使你可以简单快速地编写代码，从配置文件中解析出数据；同时，当用户决定要做出修改时，很方便地保存和更新配置。\n目前有 几种流行的配置文件格式 。对于大多数常见的配置文件格式，Java 都有对应的库library。在本文中，我将使用 XML 格式。对于一些项目，你可能会选择使用 XML，因为它的一个突出特点是能够为包含的数据提供大量相关的元数据，而在另外一些项目中，你可能会因为 XML 的冗长而不选择它。在 Java 中使用 XML 是非常容易的，因为它默认包含了许多健壮的 XML 库。\nXML 基础 讨论 XML 可是一个大话题。我有一本关于 XML 的书，它有超过 700 页的内容。幸运的是，使用 XML 并不需要非常了解它的诸多特性。就像 HTML 一样，XML 是一个带有开始和结束标记的分层标记语言，每一个标记（标签）内可以包含零个或更多数据。下面是一个 XML 的简单示例片段：\n  Penguin   在这个 自我描述的self-descriptive 例子中，XML 解析器使用了以下几个概念：\n 文档Document： 标签标志着一个 文档 的开始， 标签标志着这个文档的结束。 节点Node： 标签代表了一个 节点。 元素Element：Penguin 中，从开头的  到最后的  表示了一个 元素。 内容Content： 在  元素里，字符串 Penguin 就是 内容。  不管你信不信，只要了解了以上几个概念，你就可以开始编写、解析 XML 文件了。\n创建一个示例配置文件 要学习如何解析 XML 文件，只需要一个极简的示例文件就够了。假设现在有一个配置文件，里面保存的是关于一个图形界面窗口的属性：\n  Dark 0 Tango   创建一个名为 ~/.config/DemoXMLParser 的目录：\n$ mkdir ~/.config/DemoXMLParser 在 Linux 中，~/.config 目录是存放配置文件的默认位置，这是在 自由桌面工作组 的规范中定义的。如果你正在使用一个不遵守 自由桌面工作组Freedesktop 标准的操作系统，你也仍然可以使用这个目录，只不过你需要自己创建这些目录了。\n复制 XML 的示例配置文件，粘贴并保存为 ~/.config/DemoXMLParser/myconfig.xml 文件。\n使用 Java 解析 XML 如果你是 Java 的初学者，你可以先阅读我写的 面向 Java 入门开发者的 7 个小技巧 。一旦你对 Java 比较熟悉了，打开你最喜爱的集成开发工具（IDE），创建一个新工程。我会把我的新工程命名为 myConfigParser。\n刚开始先不要太关注依赖导入和异常捕获这些，你可以先尝试用 javax 和 java.io 包里的标准 Java 扩展来实例化一个解析器。如果你使用了 IDE，它会提示你导入合适的依赖。如果没有，你也可以在文章稍后的部分找到完整的代码，里面就有完整的依赖列表。\nPath configPath = Paths.get(System.getProperty(\"user.home\"), \".config\", \"DemoXMLParser\"); File configFile = new File(configPath.toString(), \"myconfig.xml\"); DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance(); DocumentBuilder builder = null; builder = factory.newDocumentBuilder(); Document doc = null; doc = builder.parse(configFile); doc.getDocumentElement().normalize(); 这段示例代码使用了 java.nio.Paths 类来找到用户的主目录，然后在拼接上默认配置文件的路径。接着，它用 java.io.File 类来把配置文件定义为一个 File 对象。\n紧接着，它使用了 javax.xml.parsers.DocumentBuilder 和 javax.xml.parsers.DocumentBuilderFactory 这两个类来创建一个内部的文档构造器，这样 Java 程序就可以导入并解析 XML 数据了。\n最后，Java 创建一个叫 doc 的文档对象，并且把 configFile 文件加载到这个对象里。通过使用 org.w3c.dom 包，它读取并规范化了 XML 数据。\n基本上就是这样啦。理论上来讲，你已经完成了数据解析的工作。可是，如果你不能够访问数据的话，数据解析也没有多少用处嘛。所以，就让我们再来写一些查询，从你的配置中读取重要的属性值吧。\n使用 Java 访问 XML 的值 从你已经读取的 XML 文档中获取数据，其实就是要先找到一个特定的节点，然后遍历它包含的所有元素。通常我们会使用多个循环语句来遍历节点中的元素，但是为了保持代码可读性，我会尽可能少地使用循环语句：\nNodeList nodes = doc.getElementsByTagName(\"window\"); for (int i = 0; i  nodes.getLength(); i++) { Node mynode = nodes.item(i); System.out.println(\"Property = \" + mynode.getNodeName()); if (mynode.getNodeType() == Node.ELEMENT_NODE) { Element myelement = (Element) mynode; System.out.println(\"Theme = \" + myelement.getElementsByTagName(\"theme\").item(0).getTextContent()); System.out.println(\"Fullscreen = \" + myelement.getElementsByTagName(\"fullscreen\").item(0).getTextContent()); System.out.println(\"Icon set = \" + myelement.getElementsByTagName(\"icons\").item(0).getTextContent()); } } 这段示例代码使用了 org.w3c.dom.NodeList 类，创建了一个名为 nodes 的 NodeList 对象。这个对象包含了所有名字匹配字符串 window 的子节点，实际上这样的节点只有一个，因为本文的示例配置文件中只配置了一个。\n紧接着，它使用了一个 for 循环来遍历 nodes 列表。具体过程是：根据节点出现的顺序逐个取出，然后交给一个 if-then 子句处理。这个 if-then 子句创建了一个名为 myelement 的 Element 对象，其中包含了当前节点下的所有元素。你可以使用例如 getChildNodes 和 getElementById 方法来查询这些元素，项目中还 记录了 其他查询方法。\n在这个示例中，每个元素就是配置的键。而配置的值储存在元素的内容中，你可以使用 .getTextContent 方法来提取出配置的值。\n在你的 IDE 中运行代码（或者运行编译后的二进制文件）：\n$ java ./DemoXMLParser.java Property = window Theme = Dark Fullscreen = 0 Icon set = Tango 下面是完整的代码示例：\npackage myConfigParser; import java.io.File; import java.io.IOException; import java.nio.file.Path; import java.nio.file.Paths; import javax.xml.parsers.DocumentBuilder; import javax.xml.parsers.DocumentBuilderFactory; import javax.xml.parsers.ParserConfigurationException; import org.w3c.dom.Document; import org.w3c.dom.Element; import org.w3c.dom.NamedNodeMap; import org.w3c.dom.Node; import org.w3c.dom.NodeList; import org.xml.sax.SAXException; public class ConfigParser { public static void main(String[] args) { Path configPath = Paths.get(System.getProperty(\"user.home\"), \".config\", \"DemoXMLParser\"); File configFile = new File(configPath.toString(), \"myconfig.xml\"); DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance(); DocumentBuilder builder = null; try { builder = factory.newDocumentBuilder(); } catch (ParserConfigurationException e) { e.printStackTrace(); } Document doc = null; try { doc = builder.parse(configFile); } catch (SAXException e) { e.printStackTrace(); } catch (IOException e) { e.printStackTrace(); } doc.getDocumentElement().normalize(); NodeList nodes = doc.getElementsByTagName(\"window\"); for (int i = 0; i  nodes.getLength(); i++) { Node mynode = nodes.item(i); System.out.println(\"Property = \" + mynode.getNodeName()); if (mynode.getNodeType() == Node.ELEMENT_NODE) { Element myelement = (Element) mynode; System.out.println(\"Theme = \" + myelement.getElementsByTagName(\"theme\").item(0).getTextContent()); System.out.println(\"Fullscreen = \" + myelement.getElementsByTagName(\"fullscreen\").item(0).getTextContent()); System.out.println(\"Icon set = \" + myelement.getElementsByTagName(\"icons\").item(0).getTextContent()); } // close if  } // close for  } // close method } //close class 使用 Java 更新 XML 用户时不时地会改变某个偏好项，这时候 org.w3c.dom 库就可以帮助你更新某个 XML 元素的内容。你只需要选择这个 XML 元素，就像你读取它时那样。不过，此时你不再使用 .getTextContent 方法，而是使用 .setTextContent 方法。\nupdatePref = myelement.getElementsByTagName(\"fullscreen\").item(0); updatePref.setTextContent(\"1\"); System.out.println(\"Updated fullscreen to \" + myelement.getElementsByTagName(\"fullscreen\").item(0).getTextContent()); 这么做会改变应用程序内存中的 XML 文档，但是还没有把数据写回到磁盘上。配合使用 javax 和 w3c 库，你就可以把读取到的 XML 内容写回到配置文件中。\nTransformerFactory transformerFactory = TransformerFactory.newInstance(); Transformer xtransform; xtransform = transformerFactory.newTransformer(); DOMSource mydom = new DOMSource(doc); StreamResult streamResult = new StreamResult(configFile); xtransform.transform(mydom, streamResult); 这么做会没有警告地写入转换后的数据，并覆盖掉之前的配置。\n下面是完整的代码，包括更新 XML 的操作：\npackage myConfigParser; import java.io.File; import java.io.IOException; import java.nio.file.Path; import java.nio.file.Paths; import javax.xml.parsers.DocumentBuilder; import javax.xml.parsers.DocumentBuilderFactory; import javax.xml.parsers.ParserConfigurationException; import javax.xml.transform.Transformer; import javax.xml.transform.TransformerException; import javax.xml.transform.TransformerFactory; import javax.xml.transform.dom.DOMSource; import javax.xml.transform.stream.StreamResult; import org.w3c.dom.Document; import org.w3c.dom.Element; import org.w3c.dom.Node; import org.w3c.dom.NodeList; import org.xml.sax.SAXException; public class ConfigParser { public static void main(String[] args) { Path configPath = Paths.get(System.getProperty(\"user.home\"), \".config\", \"DemoXMLParser\"); File configFile = new File(configPath.toString(), \"myconfig.xml\"); DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance(); DocumentBuilder builder = null; try { builder = factory.newDocumentBuilder(); } catch (ParserConfigurationException e) { // TODO Auto-generated catch block  e.printStackTrace(); } Document doc = null; try { doc = builder.parse(configFile); } catch (SAXException e) { // TODO Auto-generated catch block  e.printStackTrace(); } catch (IOException e) { // TODO Auto-generated catch block  e.printStackTrace(); } doc.getDocumentElement().normalize(); Node updatePref = null; // NodeList nodes = doc.getChildNodes();  NodeList nodes = doc.getElementsByTagName(\"window\"); for (int i = 0; i  nodes.getLength(); i++) { Node mynode = nodes.item(i); System.out.println(\"Property = \" + mynode.getNodeName()); if (mynode.getNodeType() == Node.ELEMENT_NODE) { Element myelement = (Element) mynode; System.out.println(\"Theme = \" + myelement.getElementsByTagName(\"theme\").item(0).getTextContent()); System.out.println(\"Fullscreen = \" + myelement.getElementsByTagName(\"fullscreen\").item(0).getTextContent()); System.out.println(\"Icon set = \" + myelement.getElementsByTagName(\"icons\").item(0).getTextContent()); updatePref = myelement.getElementsByTagName(\"fullscreen\").item(0); updatePref.setTextContent(\"2\"); System.out.println(\"Updated fullscreen to \" + myelement.getElementsByTagName(\"fullscreen\").item(0).getTextContent()); } // close if  }// close for  // write DOM back to the file  TransformerFactory transformerFactory = TransformerFactory.newInstance(); Transformer xtransform; DOMSource mydom = new DOMSource(doc); StreamResult streamResult = new StreamResult(configFile); try { xtransform = transformerFactory.newTransformer(); xtransform.transform(mydom, streamResult); } catch (TransformerException e) { e.printStackTrace(); } } // close method } //close class 如何保证配置不出问题 编写配置文件看上去是一个还挺简单的任务。一开始，你可能会用一个简单的文本格式，因为你的应用程序只要寥寥几个配置项而已。但是，随着你引入了更多的配置项，读取或者写入错误的数据可能会给你的应用程序带来意料之外的错误。一种帮助你保持配置过程安全、不出错的方法，就是使用类似 XML 的规范格式，然后依靠你用的编程语言的内置功能来处理这些复杂的事情。\n这也正是我喜欢使用 Java 和 XML 的原因。每当我试图读取错误的配置值时，Java 就会提醒我。通常，这是由于我在代码中试图获取的节点，并不存在于我期望的 XML 路径中。XML 这种高度结构化的格式帮助了代码保持可靠性，这对用户和开发者来说都是有好处的。\n  本文使用 CC BY-SA 4.0 国际协议 进行许可，欢迎遵照协议规定转载。\n链接：https://lkxed.github.io/posts/parsing-xml-java/ 作者：Seth Kenlon / 译者：六开箱 原文：Parsing config files with Java 首发：使用 Java 解析 XML 文件 @ Linux 中国  ","wordCount":"3141","inLanguage":"zh","datePublished":"2022-03-22T09:16:56+08:00","dateModified":"2022-03-22T09:16:56+08:00","author":{"@type":"Person","name":"六开箱"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lkxed.github.io/posts/parsing-xml-java/"},"publisher":{"@type":"Organization","name":"六开箱","logo":{"@type":"ImageObject","url":"https://lkxed.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://lkxed.github.io/ accesskey=h title="六开箱 (Alt + H)"><img src=https://lkxed.github.io/favicon.ico alt=logo aria-label=logo height=30>六开箱</a></div><ul id=menu><li><a href=https://lkxed.github.io/posts/ title=文章><span>文章</span></a></li><li><a href=https://lkxed.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://lkxed.github.io/series/ title=系列><span>系列</span></a></li><li><a href=https://lkxed.github.io/tags/ title=标签><span>标签</span></a></li><li><a href=https://lkxed.github.io/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>使用 Java 解析 XML 文件</h1><div class=post-meta><span title="2022-03-22 09:16:56 +0800 CST">2022 年 3 月 22 日</span>&nbsp;·&nbsp;3141 字&nbsp;·&nbsp;六开箱&nbsp;｜&nbsp;<a href=https://github.com/lkxed/ rel="noopener noreferrer" target=_blank>关注我🌟</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=前言>前言</a></li><li><a href=#%e9%80%89%e6%8b%a9%e4%b8%80%e4%b8%aa%e6%a0%bc%e5%bc%8f aria-label=选择一个格式>选择一个格式</a></li><li><a href=#xml-%e5%9f%ba%e7%a1%80 aria-label="XML 基础">XML 基础</a></li><li><a href=#%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%a4%ba%e4%be%8b%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label=创建一个示例配置文件>创建一个示例配置文件</a></li><li><a href=#%e4%bd%bf%e7%94%a8-java-%e8%a7%a3%e6%9e%90-xml aria-label="使用 Java 解析 XML">使用 Java 解析 XML</a></li><li><a href=#%e4%bd%bf%e7%94%a8-java-%e8%ae%bf%e9%97%ae-xml-%e7%9a%84%e5%80%bc aria-label="使用 Java 访问 XML 的值">使用 Java 访问 XML 的值</a></li><li><a href=#%e4%bd%bf%e7%94%a8-java-%e6%9b%b4%e6%96%b0-xml aria-label="使用 Java 更新 XML">使用 Java 更新 XML</a></li><li><a href=#%e5%a6%82%e4%bd%95%e4%bf%9d%e8%af%81%e9%85%8d%e7%bd%ae%e4%b8%8d%e5%87%ba%e9%97%ae%e9%a2%98 aria-label=如何保证配置不出问题>如何保证配置不出问题</a></li></ul></div></details></div><div class=post-content><blockquote><p>在你使用 Java 编写软件时实现持久化配置。</p></blockquote><p><img loading=lazy src=https://img.linux.net.cn/data/attachment/album/202203/22/091553wf2gvj20fn4wfgpw.jpg alt></p><h2 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h2><p>当你编写一个应用时，你通常都会希望用户能够定制化他们和应用交互的方式，以及应用与系统进行交互的方式。这种方式通常被称为 “<ruby>偏好<rt>preference</rt></ruby>” 或者 “<ruby>设置<rt>setting</rt></ruby>”，它们被保存在一个 “偏好文件” 或者 “配置文件” 中，有时也直接简称为 “<ruby>配置<rt>config</rt></ruby>”。配置文件可以有很多种格式，包括 INI、JSON、YAML 和 XML。每一种编程语言解析这些格式的方式都不同。本文主要讨论，当你在使用 <a href=https://opensource.com/resources/java target=_blank rel="noopener noreferrer">Java 编程语言</a>
来编写软件时，实现持久化配置的方式。</p><h2 id=选择一个格式>选择一个格式<a hidden class=anchor aria-hidden=true href=#选择一个格式>#</a></h2><p>编写配置文件是一件相当复杂的事情。我曾经试过把配置项使用逗号分隔保存在一个文本文件里，也试过把配置项保存在非常详细的 YAML 和 XML 中。对于配置文件来说，最重要是要有一致性和规律性，它们使你可以简单快速地编写代码，从配置文件中解析出数据；同时，当用户决定要做出修改时，很方便地保存和更新配置。</p><p>目前有 <a href=https://opensource.com/article/21/6/what-config-files target=_blank rel="noopener noreferrer">几种流行的配置文件格式</a>
。对于大多数常见的配置文件格式，Java 都有对应的<ruby>库<rt>library</rt></ruby>。在本文中，我将使用 XML 格式。对于一些项目，你可能会选择使用 XML，因为它的一个突出特点是能够为包含的数据提供大量相关的元数据，而在另外一些项目中，你可能会因为 XML 的冗长而不选择它。在 Java 中使用 XML 是非常容易的，因为它默认包含了许多健壮的 XML 库。</p><h2 id=xml-基础>XML 基础<a hidden class=anchor aria-hidden=true href=#xml-基础>#</a></h2><p>讨论 XML 可是一个大话题。我有一本关于 XML 的书，它有超过 700 页的内容。幸运的是，使用 XML 并不需要非常了解它的诸多特性。就像 HTML 一样，XML 是一个带有开始和结束标记的分层标记语言，每一个标记（标签）内可以包含零个或更多数据。下面是一个 XML 的简单示例片段：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;xml&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;node&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;element&gt;</span>Penguin<span class=nt>&lt;/element&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/node&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/xml&gt;</span>
</span></span></code></pre></div><p>在这个 <ruby>自我描述的<rt>self-descriptive</rt></ruby> 例子中，XML 解析器使用了以下几个概念：</p><ul><li><ruby>文档<rt>Document</rt></ruby>：<code>&lt;xml></code> 标签标志着一个 <strong>文档</strong> 的开始，<code>&lt;/xml></code> 标签标志着这个文档的结束。</li><li><ruby>节点<rt>Node</rt></ruby>：<code>&lt;node></code> 标签代表了一个 <strong>节点</strong>。</li><li><ruby>元素<rt>Element</rt></ruby>：<code>&lt;element>Penguin&lt;/element></code> 中，从开头的 <code>&lt;</code> 到最后的 <code>></code> 表示了一个 <strong>元素</strong>。</li><li><ruby>内容<rt>Content</rt></ruby>： 在 <code>&lt;element></code> 元素里，字符串 <code>Penguin</code> 就是 <strong>内容</strong>。</li></ul><p>不管你信不信，只要了解了以上几个概念，你就可以开始编写、解析 XML 文件了。</p><h2 id=创建一个示例配置文件>创建一个示例配置文件<a hidden class=anchor aria-hidden=true href=#创建一个示例配置文件>#</a></h2><p>要学习如何解析 XML 文件，只需要一个极简的示例文件就够了。假设现在有一个配置文件，里面保存的是关于一个图形界面窗口的属性：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;xml&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;window&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;theme&gt;</span>Dark<span class=nt>&lt;/theme&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;fullscreen&gt;</span>0<span class=nt>&lt;/fullscreen&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;icons&gt;</span>Tango<span class=nt>&lt;/icons&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/window&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/xml&gt;</span>
</span></span></code></pre></div><p>创建一个名为 <code>~/.config/DemoXMLParser</code> 的目录：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>$</span> <span class=n>mkdir</span> <span class=o>~/.</span><span class=na>config</span><span class=o>/</span><span class=n>DemoXMLParser</span>
</span></span></code></pre></div><p>在 Linux 中，<code>~/.config</code> 目录是存放配置文件的默认位置，这是在 <a href=https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html target=_blank rel="noopener noreferrer">自由桌面工作组</a>
的规范中定义的。如果你正在使用一个不遵守 <ruby>自由桌面工作组<rt>Freedesktop</rt><ruby> 标准的操作系统，你也仍然可以使用这个目录，只不过你需要自己创建这些目录了。</p><p>复制 XML 的示例配置文件，粘贴并保存为 <code>~/.config/DemoXMLParser/myconfig.xml</code> 文件。</p><h2 id=使用-java-解析-xml>使用 Java 解析 XML<a hidden class=anchor aria-hidden=true href=#使用-java-解析-xml>#</a></h2><p>如果你是 Java 的初学者，你可以先阅读我写的 <a href=https://opensource.com/article/19/10/java-basics target=_blank rel="noopener noreferrer">面向 Java 入门开发者的 7 个小技巧</a>
。一旦你对 Java 比较熟悉了，打开你最喜爱的集成开发工具（IDE），创建一个新工程。我会把我的新工程命名为 <code>myConfigParser</code>。</p><p>刚开始先不要太关注依赖导入和异常捕获这些，你可以先尝试用 <code>javax</code> 和 <code>java.io</code> 包里的标准 Java 扩展来实例化一个解析器。如果你使用了 IDE，它会提示你导入合适的依赖。如果没有，你也可以在文章稍后的部分找到完整的代码，里面就有完整的依赖列表。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Path</span> <span class=n>configPath</span> <span class=o>=</span> <span class=n>Paths</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>getProperty</span><span class=o>(</span><span class=s>&#34;user.home&#34;</span><span class=o>),</span> <span class=s>&#34;.config&#34;</span><span class=o>,</span> <span class=s>&#34;DemoXMLParser&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>File</span> <span class=n>configFile</span> <span class=o>=</span> <span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=n>configPath</span><span class=o>.</span><span class=na>toString</span><span class=o>(),</span> <span class=s>&#34;myconfig.xml&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>DocumentBuilderFactory</span> <span class=n>factory</span> <span class=o>=</span> <span class=n>DocumentBuilderFactory</span><span class=o>.</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>DocumentBuilder</span> <span class=n>builder</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=n>builder</span> <span class=o>=</span> <span class=n>factory</span><span class=o>.</span><span class=na>newDocumentBuilder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Document</span> <span class=n>doc</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=n>doc</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=n>configFile</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>doc</span><span class=o>.</span><span class=na>getDocumentElement</span><span class=o>().</span><span class=na>normalize</span><span class=o>();</span>
</span></span></code></pre></div><p>这段示例代码使用了 <code>java.nio.Paths</code> 类来找到用户的主目录，然后在拼接上默认配置文件的路径。接着，它用 <code>java.io.File</code> 类来把配置文件定义为一个 <code>File</code> 对象。</p><p>紧接着，它使用了 <code>javax.xml.parsers.DocumentBuilder</code> 和 <code>javax.xml.parsers.DocumentBuilderFactory</code> 这两个类来创建一个内部的文档构造器，这样 Java 程序就可以导入并解析 XML 数据了。</p><p>最后，Java 创建一个叫 <code>doc</code> 的文档对象，并且把 <code>configFile</code> 文件加载到这个对象里。通过使用 <code>org.w3c.dom</code> 包，它读取并规范化了 XML 数据。</p><p>基本上就是这样啦。理论上来讲，你已经完成了数据解析的工作。可是，如果你不能够访问数据的话，数据解析也没有多少用处嘛。所以，就让我们再来写一些查询，从你的配置中读取重要的属性值吧。</p><h2 id=使用-java-访问-xml-的值>使用 Java 访问 XML 的值<a hidden class=anchor aria-hidden=true href=#使用-java-访问-xml-的值>#</a></h2><p>从你已经读取的 XML 文档中获取数据，其实就是要先找到一个特定的节点，然后遍历它包含的所有元素。通常我们会使用多个循环语句来遍历节点中的元素，但是为了保持代码可读性，我会尽可能少地使用循环语句：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>NodeList</span> <span class=n>nodes</span> <span class=o>=</span> <span class=n>doc</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;window&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>nodes</span><span class=o>.</span><span class=na>getLength</span><span class=o>();</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl> <span class=n>Node</span> <span class=n>mynode</span> <span class=o>=</span> <span class=n>nodes</span><span class=o>.</span><span class=na>item</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
</span></span><span class=line><span class=cl> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Property = &#34;</span> <span class=o>+</span> <span class=n>mynode</span><span class=o>.</span><span class=na>getNodeName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl> <span class=k>if</span> <span class=o>(</span><span class=n>mynode</span><span class=o>.</span><span class=na>getNodeType</span><span class=o>()</span> <span class=o>==</span> <span class=n>Node</span><span class=o>.</span><span class=na>ELEMENT_NODE</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>   <span class=n>Element</span> <span class=n>myelement</span> <span class=o>=</span> <span class=o>(</span><span class=n>Element</span><span class=o>)</span> <span class=n>mynode</span><span class=o>;</span>
</span></span><span class=line><span class=cl>             
</span></span><span class=line><span class=cl>   <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Theme = &#34;</span> <span class=o>+</span> <span class=n>myelement</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;theme&#34;</span><span class=o>).</span><span class=na>item</span><span class=o>(</span><span class=n>0</span><span class=o>).</span><span class=na>getTextContent</span><span class=o>());</span>
</span></span><span class=line><span class=cl>   <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Fullscreen = &#34;</span> <span class=o>+</span> <span class=n>myelement</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;fullscreen&#34;</span><span class=o>).</span><span class=na>item</span><span class=o>(</span><span class=n>0</span><span class=o>).</span><span class=na>getTextContent</span><span class=o>());</span>
</span></span><span class=line><span class=cl>   <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Icon set = &#34;</span> <span class=o>+</span> <span class=n>myelement</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;icons&#34;</span><span class=o>).</span><span class=na>item</span><span class=o>(</span><span class=n>0</span><span class=o>).</span><span class=na>getTextContent</span><span class=o>());</span>
</span></span><span class=line><span class=cl> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>这段示例代码使用了 <code>org.w3c.dom.NodeList</code> 类，创建了一个名为 <code>nodes</code> 的 <code>NodeList</code> 对象。这个对象包含了所有名字匹配字符串 <code>window</code> 的子节点，实际上这样的节点只有一个，因为本文的示例配置文件中只配置了一个。</p><p>紧接着，它使用了一个 <code>for</code> 循环来遍历 <code>nodes</code> 列表。具体过程是：根据节点出现的顺序逐个取出，然后交给一个 <code>if-then</code> 子句处理。这个 <code>if-then</code> 子句创建了一个名为 <code>myelement</code> 的 <code>Element</code> 对象，其中包含了当前节点下的所有元素。你可以使用例如 <code>getChildNodes</code> 和 <code>getElementById</code> 方法来查询这些元素，项目中还 <a href=https://www.w3.org/2003/01/dom2-javadoc/org/w3c/dom/Document.html target=_blank rel="noopener noreferrer">记录了</a>
其他查询方法。</p><p>在这个示例中，每个元素就是配置的键。而配置的值储存在元素的内容中，你可以使用 <code>.getTextContent</code> 方法来提取出配置的值。</p><p>在你的 IDE 中运行代码（或者运行编译后的二进制文件）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ java ./DemoXMLParser.java
</span></span><span class=line><span class=cl><span class=nv>Property</span> <span class=o>=</span> window
</span></span><span class=line><span class=cl><span class=nv>Theme</span> <span class=o>=</span> Dark
</span></span><span class=line><span class=cl><span class=nv>Fullscreen</span> <span class=o>=</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>Icon <span class=nb>set</span> <span class=o>=</span> Tango
</span></span></code></pre></div><p>下面是完整的代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>myConfigParser</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.File</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.nio.file.Path</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.nio.file.Paths</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.xml.parsers.DocumentBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.xml.parsers.DocumentBuilderFactory</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.xml.parsers.ParserConfigurationException</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.w3c.dom.Document</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.w3c.dom.Element</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.w3c.dom.NamedNodeMap</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.w3c.dom.Node</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.w3c.dom.NodeList</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.xml.sax.SAXException</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ConfigParser</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>Path</span> <span class=n>configPath</span> <span class=o>=</span> <span class=n>Paths</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>getProperty</span><span class=o>(</span><span class=s>&#34;user.home&#34;</span><span class=o>),</span> <span class=s>&#34;.config&#34;</span><span class=o>,</span> <span class=s>&#34;DemoXMLParser&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>File</span> <span class=n>configFile</span> <span class=o>=</span> <span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=n>configPath</span><span class=o>.</span><span class=na>toString</span><span class=o>(),</span> <span class=s>&#34;myconfig.xml&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>DocumentBuilderFactory</span> <span class=n>factory</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>                <span class=n>DocumentBuilderFactory</span><span class=o>.</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=n>DocumentBuilder</span> <span class=n>builder</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>               
</span></span><span class=line><span class=cl>                <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>builder</span> <span class=o>=</span> <span class=n>factory</span><span class=o>.</span><span class=na>newDocumentBuilder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ParserConfigurationException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>                <span class=n>Document</span> <span class=n>doc</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>                <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>doc</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=n>configFile</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>SAXException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>doc</span><span class=o>.</span><span class=na>getDocumentElement</span><span class=o>().</span><span class=na>normalize</span><span class=o>();</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>        <span class=n>NodeList</span> <span class=n>nodes</span> <span class=o>=</span> <span class=n>doc</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;window&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>nodes</span><span class=o>.</span><span class=na>getLength</span><span class=o>();</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>           <span class=n>Node</span> <span class=n>mynode</span> <span class=o>=</span> <span class=n>nodes</span><span class=o>.</span><span class=na>item</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
</span></span><span class=line><span class=cl>           <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Property = &#34;</span> <span class=o>+</span> <span class=n>mynode</span><span class=o>.</span><span class=na>getNodeName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>           
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=o>(</span><span class=n>mynode</span><span class=o>.</span><span class=na>getNodeType</span><span class=o>()</span> <span class=o>==</span> <span class=n>Node</span><span class=o>.</span><span class=na>ELEMENT_NODE</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>               <span class=n>Element</span> <span class=n>myelement</span> <span class=o>=</span> <span class=o>(</span><span class=n>Element</span><span class=o>)</span> <span class=n>mynode</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>               <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Theme = &#34;</span> <span class=o>+</span> <span class=n>myelement</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;theme&#34;</span><span class=o>).</span><span class=na>item</span><span class=o>(</span><span class=n>0</span><span class=o>).</span><span class=na>getTextContent</span><span class=o>());</span>
</span></span><span class=line><span class=cl>               <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Fullscreen = &#34;</span> <span class=o>+</span> <span class=n>myelement</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;fullscreen&#34;</span><span class=o>).</span><span class=na>item</span><span class=o>(</span><span class=n>0</span><span class=o>).</span><span class=na>getTextContent</span><span class=o>());</span>
</span></span><span class=line><span class=cl>               <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Icon set = &#34;</span> <span class=o>+</span> <span class=n>myelement</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;icons&#34;</span><span class=o>).</span><span class=na>item</span><span class=o>(</span><span class=n>0</span><span class=o>).</span><span class=na>getTextContent</span><span class=o>());</span>
</span></span><span class=line><span class=cl>           <span class=o>}</span> <span class=c1>// close if
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>}</span> <span class=c1>// close for
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span> <span class=c1>// close method
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span> <span class=c1>//close class
</span></span></span></code></pre></div><h2 id=使用-java-更新-xml>使用 Java 更新 XML<a hidden class=anchor aria-hidden=true href=#使用-java-更新-xml>#</a></h2><p>用户时不时地会改变某个偏好项，这时候 <code>org.w3c.dom</code> 库就可以帮助你更新某个 XML 元素的内容。你只需要选择这个 XML 元素，就像你读取它时那样。不过，此时你不再使用 <code>.getTextContent</code> 方法，而是使用 <code>.setTextContent</code> 方法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>updatePref</span> <span class=o>=</span> <span class=n>myelement</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;fullscreen&#34;</span><span class=o>).</span><span class=na>item</span><span class=o>(</span><span class=n>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>updatePref</span><span class=o>.</span><span class=na>setTextContent</span><span class=o>(</span><span class=s>&#34;1&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Updated fullscreen to &#34;</span> <span class=o>+</span> <span class=n>myelement</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;fullscreen&#34;</span><span class=o>).</span><span class=na>item</span><span class=o>(</span><span class=n>0</span><span class=o>).</span><span class=na>getTextContent</span><span class=o>());</span>  
</span></span></code></pre></div><p>这么做会改变应用程序内存中的 XML 文档，但是还没有把数据写回到磁盘上。配合使用 <code>javax</code> 和 <code>w3c</code> 库，你就可以把读取到的 XML 内容写回到配置文件中。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>TransformerFactory</span> <span class=n>transformerFactory</span> <span class=o>=</span> <span class=n>TransformerFactory</span><span class=o>.</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Transformer</span> <span class=n>xtransform</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=n>xtransform</span> <span class=o>=</span> <span class=n>transformerFactory</span><span class=o>.</span><span class=na>newTransformer</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>DOMSource</span> <span class=n>mydom</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DOMSource</span><span class=o>(</span><span class=n>doc</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>StreamResult</span> <span class=n>streamResult</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StreamResult</span><span class=o>(</span><span class=n>configFile</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>xtransform</span><span class=o>.</span><span class=na>transform</span><span class=o>(</span><span class=n>mydom</span><span class=o>,</span> <span class=n>streamResult</span><span class=o>);</span>
</span></span></code></pre></div><p>这么做会没有警告地写入转换后的数据，并覆盖掉之前的配置。</p><p>下面是完整的代码，包括更新 XML 的操作：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>myConfigParser</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.File</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.nio.file.Path</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.nio.file.Paths</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.xml.parsers.DocumentBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.xml.parsers.DocumentBuilderFactory</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.xml.parsers.ParserConfigurationException</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.xml.transform.Transformer</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.xml.transform.TransformerException</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.xml.transform.TransformerFactory</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.xml.transform.dom.DOMSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.xml.transform.stream.StreamResult</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.w3c.dom.Document</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.w3c.dom.Element</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.w3c.dom.Node</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.w3c.dom.NodeList</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.xml.sax.SAXException</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ConfigParser</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>Path</span> <span class=n>configPath</span> <span class=o>=</span> <span class=n>Paths</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>getProperty</span><span class=o>(</span><span class=s>&#34;user.home&#34;</span><span class=o>),</span> <span class=s>&#34;.config&#34;</span><span class=o>,</span> <span class=s>&#34;DemoXMLParser&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>File</span> <span class=n>configFile</span> <span class=o>=</span> <span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=n>configPath</span><span class=o>.</span><span class=na>toString</span><span class=o>(),</span> <span class=s>&#34;myconfig.xml&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>DocumentBuilderFactory</span> <span class=n>factory</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>                <span class=n>DocumentBuilderFactory</span><span class=o>.</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=n>DocumentBuilder</span> <span class=n>builder</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>               
</span></span><span class=line><span class=cl>                <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>builder</span> <span class=o>=</span> <span class=n>factory</span><span class=o>.</span><span class=na>newDocumentBuilder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ParserConfigurationException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=c1>// TODO Auto-generated catch block
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>                <span class=n>Document</span> <span class=n>doc</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>                <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>doc</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=n>configFile</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>SAXException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=c1>// TODO Auto-generated catch block
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=c1>// TODO Auto-generated catch block
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>doc</span><span class=o>.</span><span class=na>getDocumentElement</span><span class=o>().</span><span class=na>normalize</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Node</span> <span class=n>updatePref</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=c1>//        NodeList nodes = doc.getChildNodes();
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>NodeList</span> <span class=n>nodes</span> <span class=o>=</span> <span class=n>doc</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;window&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>nodes</span><span class=o>.</span><span class=na>getLength</span><span class=o>();</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>           <span class=n>Node</span> <span class=n>mynode</span> <span class=o>=</span> <span class=n>nodes</span><span class=o>.</span><span class=na>item</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
</span></span><span class=line><span class=cl>           <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Property = &#34;</span> <span class=o>+</span> <span class=n>mynode</span><span class=o>.</span><span class=na>getNodeName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>           
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=o>(</span><span class=n>mynode</span><span class=o>.</span><span class=na>getNodeType</span><span class=o>()</span> <span class=o>==</span> <span class=n>Node</span><span class=o>.</span><span class=na>ELEMENT_NODE</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>               <span class=n>Element</span> <span class=n>myelement</span> <span class=o>=</span> <span class=o>(</span><span class=n>Element</span><span class=o>)</span> <span class=n>mynode</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>               <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Theme = &#34;</span> <span class=o>+</span> <span class=n>myelement</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;theme&#34;</span><span class=o>).</span><span class=na>item</span><span class=o>(</span><span class=n>0</span><span class=o>).</span><span class=na>getTextContent</span><span class=o>());</span>
</span></span><span class=line><span class=cl>               <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Fullscreen = &#34;</span> <span class=o>+</span> <span class=n>myelement</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;fullscreen&#34;</span><span class=o>).</span><span class=na>item</span><span class=o>(</span><span class=n>0</span><span class=o>).</span><span class=na>getTextContent</span><span class=o>());</span>
</span></span><span class=line><span class=cl>               <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Icon set = &#34;</span> <span class=o>+</span> <span class=n>myelement</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;icons&#34;</span><span class=o>).</span><span class=na>item</span><span class=o>(</span><span class=n>0</span><span class=o>).</span><span class=na>getTextContent</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>               <span class=n>updatePref</span> <span class=o>=</span> <span class=n>myelement</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;fullscreen&#34;</span><span class=o>).</span><span class=na>item</span><span class=o>(</span><span class=n>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>               <span class=n>updatePref</span><span class=o>.</span><span class=na>setTextContent</span><span class=o>(</span><span class=s>&#34;2&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>               <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Updated fullscreen to &#34;</span> <span class=o>+</span> <span class=n>myelement</span><span class=o>.</span><span class=na>getElementsByTagName</span><span class=o>(</span><span class=s>&#34;fullscreen&#34;</span><span class=o>).</span><span class=na>item</span><span class=o>(</span><span class=n>0</span><span class=o>).</span><span class=na>getTextContent</span><span class=o>());</span>          
</span></span><span class=line><span class=cl>           <span class=o>}</span> <span class=c1>// close if
</span></span></span><span class=line><span class=cl><span class=c1></span>           
</span></span><span class=line><span class=cl>        <span class=o>}</span><span class=c1>// close for
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=c1>// write DOM back to the file
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>TransformerFactory</span> <span class=n>transformerFactory</span> <span class=o>=</span> <span class=n>TransformerFactory</span><span class=o>.</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Transformer</span> <span class=n>xtransform</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>DOMSource</span> <span class=n>mydom</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DOMSource</span><span class=o>(</span><span class=n>doc</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>StreamResult</span> <span class=n>streamResult</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StreamResult</span><span class=o>(</span><span class=n>configFile</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>xtransform</span> <span class=o>=</span> <span class=n>transformerFactory</span><span class=o>.</span><span class=na>newTransformer</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=n>xtransform</span><span class=o>.</span><span class=na>transform</span><span class=o>(</span><span class=n>mydom</span><span class=o>,</span> <span class=n>streamResult</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>TransformerException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>                       
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=c1>// close method
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span> <span class=c1>//close class
</span></span></span></code></pre></div><h2 id=如何保证配置不出问题>如何保证配置不出问题<a hidden class=anchor aria-hidden=true href=#如何保证配置不出问题>#</a></h2><p>编写配置文件看上去是一个还挺简单的任务。一开始，你可能会用一个简单的文本格式，因为你的应用程序只要寥寥几个配置项而已。但是，随着你引入了更多的配置项，读取或者写入错误的数据可能会给你的应用程序带来意料之外的错误。一种帮助你保持配置过程安全、不出错的方法，就是使用类似 XML 的规范格式，然后依靠你用的编程语言的内置功能来处理这些复杂的事情。</p><p>这也正是我喜欢使用 Java 和 XML 的原因。每当我试图读取错误的配置值时，Java 就会提醒我。通常，这是由于我在代码中试图获取的节点，并不存在于我期望的 XML 路径中。XML 这种高度结构化的格式帮助了代码保持可靠性，这对用户和开发者来说都是有好处的。</p><hr><blockquote><p>本文使用 <a href=https://creativecommons.org/licenses/by-sa/4.0/deed.zh target=_blank rel="noopener noreferrer">CC BY-SA 4.0 国际协议</a>
进行许可，欢迎<strong>遵照协议规定</strong>转载。<br>链接：<a href=https://lkxed.github.io/posts/parsing-xml-java/ target=_blank rel="noopener noreferrer">https://lkxed.github.io/posts/parsing-xml-java/</a><br>作者：<a href=https://opensource.com/users/seth target=_blank rel="noopener noreferrer">Seth Kenlon</a>
/ 译者：<a href=https://github.com/lkxed/ target=_blank rel="noopener noreferrer">六开箱</a><br>原文：<a href=https://opensource.com/article/21/7/parsing-config-files-java target=_blank rel="noopener noreferrer">Parsing config files with Java</a><br>首发：<a href=https://linux.cn/article-14381-1.html target=_blank rel="noopener noreferrer">使用 Java 解析 XML 文件</a>
@ <a href=https://linux.cn/ target=_blank rel="noopener noreferrer">Linux 中国</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://lkxed.github.io/tags/%E8%AF%91%E6%96%87/>译文</a></li><li><a href=https://lkxed.github.io/tags/java/>Java</a></li><li><a href=https://lkxed.github.io/tags/xml/>XML</a></li><li><a href=https://lkxed.github.io/tags/%E6%95%99%E7%A8%8B/>教程</a></li></ul><nav class=paginav><a class=prev href=https://lkxed.github.io/posts/open-source-guides-teachers/><span class=title>« 上一页</span><br><span>5 个方便的开源指南：为教师而准备</span></a>
<a class=next href=https://lkxed.github.io/posts/creating-maps-groovy-java/><span class=title>下一页 »</span><br><span>Groovy 对比 Java：创建并初始化 Map</span></a></nav></footer><script src=https://giscus.app/client.js data-repo=lkxed/lkxed.github.io data-repo-id=R_kgDOHF00eA data-category=Announcements data-category-id=DIC_kwDOHF00eM4COXzh data-mapping=og:title data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><div class=social-icons><a href=https://github.com/lkxed/ target=_blank rel="noopener noreferrer me" title=GitHub><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://space.bilibili.com/88033726/ target=_blank rel="noopener noreferrer me" title=Bilibili><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" xmlns="http://www.w3.org/2000/svg"><rect x="1.3333" y="6" width="21.333" height="15.333" rx="4" ry="4"/><path d="m8 12.4v1.2"/><path d="m16 12.4v1.2"/><path d="m5.8853 2.6667L8.552 5.3334"/><path d="m18.115 2.6667-2.6667 2.6667"/></svg></a></div><span>&copy; 2022 <a href=https://lkxed.github.io/>六开箱</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/lkxed/hugo-PaperMod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="复制";function s(){e.innerText="已复制！",setTimeout(()=>{e.innerText="复制"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>